"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7718],{1111(e,s,a){a.d(s,{$:()=>h});var t=a(2555),i=a(3986),r=a(9950),l=a(2962),d=a(4364),n=a(9332),c=a(4414);const o=["className","variant","size","asChild"],m=(0,d.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-500 text-white shadow-sm hover:bg-blue-600 rounded-lg",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-gray-200 bg-white shadow-sm hover:bg-gray-50 text-gray-700 rounded-lg",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=r.forwardRef((e,s)=>{let{className:a,variant:r,size:d,asChild:h=!1}=e,x=(0,i.A)(e,o);const u=h?l.DX:"button";return(0,c.jsx)(u,(0,t.A)({className:(0,n.cn)(m({variant:r,size:d,className:a})),ref:s},x))});h.displayName="Button"},4245(e,s,a){a.d(s,{BT:()=>j,Wu:()=>g,ZB:()=>b,Zp:()=>u,aR:()=>p});var t=a(2555),i=a(3986),r=a(9950),l=a(9332),d=a(4414);const n=["className"],c=["className"],o=["className"],m=["className"],h=["className"],x=["className"],u=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,n);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("rounded-xl border border-gray-200 bg-white text-gray-900 shadow-sm",a)},r))});u.displayName="Card";const p=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,c);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-5",a)},r))});p.displayName="CardHeader";const b=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,o);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("font-semibold leading-none tracking-tight",a)},r))});b.displayName="CardTitle";const j=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,m);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a)},r))});j.displayName="CardDescription";const g=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,h);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("p-5 pt-0",a)},r))});g.displayName="CardContent";r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,x);return(0,d.jsx)("div",(0,t.A)({ref:s,className:(0,l.cn)("flex items-center p-5 pt-0",a)},r))}).displayName="CardFooter"},7255(e,s,a){a.d(s,{Cf:()=>v,L3:()=>_,c7:()=>f,lG:()=>p,rr:()=>N,zM:()=>b});var t=a(2555),i=a(3986),r=a(9950),l=a(9710),d=a(6479),n=a(9332),c=a(4414);const o=["className"],m=["className","children"],h=["className"],x=["className"],u=["className"],p=l.bL,b=l.l9,j=l.ZL,g=(l.bm,r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,o);return(0,c.jsx)(l.hJ,(0,t.A)({ref:s,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a)},r))}));g.displayName=l.hJ.displayName;const v=r.forwardRef((e,s)=>{let{className:a,children:r}=e,o=(0,i.A)(e,m);return(0,c.jsxs)(j,{children:[(0,c.jsx)(g,{}),(0,c.jsxs)(l.UC,(0,t.A)((0,t.A)({ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a)},o),{},{children:[r,(0,c.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,c.jsx)(d.A,{className:"h-4 w-4"}),(0,c.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});v.displayName=l.UC.displayName;const f=e=>{let{className:s}=e,a=(0,i.A)(e,h);return(0,c.jsx)("div",(0,t.A)({className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s)},a))};f.displayName="DialogHeader";const _=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,x);return(0,c.jsx)(l.hE,(0,t.A)({ref:s,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",a)},r))});_.displayName=l.hE.displayName;const N=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,u);return(0,c.jsx)(l.VY,(0,t.A)({ref:s,className:(0,n.cn)("text-sm text-muted-foreground",a)},r))});N.displayName=l.VY.displayName},4779(e,s,a){a.d(s,{p:()=>c});var t=a(2555),i=a(3986),r=a(9950),l=a(9332),d=a(4414);const n=["className","type"],c=r.forwardRef((e,s)=>{let{className:a,type:r}=e,c=(0,i.A)(e,n);return(0,d.jsx)("input",(0,t.A)({type:r,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s},c))});c.displayName="Input"},557(e,s,a){a.d(s,{J:()=>h});var t=a(2555),i=a(3986),r=a(9950),l=a(1611),d=a(4364),n=a(9332),c=a(4414);const o=["className"],m=(0,d.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,o);return(0,c.jsx)(l.b,(0,t.A)({ref:s,className:(0,n.cn)(m(),a)},r))});h.displayName=l.b.displayName},5475(e,s,a){a.d(s,{Xi:()=>u,av:()=>p,j7:()=>x,tU:()=>h});var t=a(2555),i=a(3986),r=a(9950),l=a(7970),d=a(9332),n=a(4414);const c=["className"],o=["className"],m=["className"],h=l.bL,x=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,c);return(0,n.jsx)(l.B8,(0,t.A)({ref:s,className:(0,d.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-gray-100 border border-gray-200 p-1 text-muted-foreground",a)},r))});x.displayName=l.B8.displayName;const u=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,o);return(0,n.jsx)(l.l9,(0,t.A)({ref:s,className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:border-b-2 data-[state=active]:border-blue-500",a)},r))});u.displayName=l.l9.displayName;const p=r.forwardRef((e,s)=>{let{className:a}=e,r=(0,i.A)(e,m);return(0,n.jsx)(l.UC,(0,t.A)({ref:s,className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a)},r))});p.displayName=l.UC.displayName},9332(e,s,a){a.d(s,{cn:()=>r});var t=a(2004),i=a(9800);function r(){for(var e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,i.QP)((0,t.$)(s))}},7718(e,s,a){a.r(s),a.d(s,{default:()=>P});var t=a(2555),i=a(9950),r=a(5030),l=a(5532),d=a(1111),n=a(4779),c=a(557),o=a(7255),m=a(4245),h=a(5475),x=a(2828),u=a(2989),p=a(978),b=a(903),j=a(9201),g=a(6311),v=a(7737),f=a(8890),_=a(2607),N=a(5107),y=a(6987),w=a(1742),A=a(9318),k=a(4814),C=a(3581),S=a(1064),R=a(9975),J=a(2033),B=a(6910),I=a(4414);const $="".concat("","/api"),z=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],T=["\u0938\u094b\u092e\u0935\u093e\u0930","\u092e\u0902\u0917\u0932\u0935\u093e\u0930","\u092c\u0941\u0927\u0935\u093e\u0930","\u0917\u0941\u0930\u0941\u0935\u093e\u0930","\u0936\u0941\u0915\u094d\u0930\u0935\u093e\u0930","\u0936\u0928\u093f\u0935\u093e\u0930"],M={Hindi:"bg-orange-100 border-orange-300 text-orange-800",English:"bg-blue-100 border-blue-300 text-blue-800",Mathematics:"bg-green-100 border-green-300 text-green-800",Science:"bg-purple-100 border-purple-300 text-purple-800","Social Science":"bg-yellow-100 border-yellow-300 text-yellow-800",Computer:"bg-cyan-100 border-cyan-300 text-cyan-800","Physical Education":"bg-red-100 border-red-300 text-red-800",Drawing:"bg-pink-100 border-pink-300 text-pink-800",Music:"bg-indigo-100 border-indigo-300 text-indigo-800",GK:"bg-teal-100 border-teal-300 text-teal-800","Moral Science":"bg-amber-100 border-amber-300 text-amber-800",Sanskrit:"bg-rose-100 border-rose-300 text-rose-800",default:"bg-slate-100 border-slate-300 text-slate-800"},E={normal_period_duration:40,first_period_extra_mins:10,school_start_time:"08:00",break_duration:15,lunch_duration:30,break_after_period:3,lunch_after_period:5,periods_per_day:8,working_days:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},F=e=>M[e]||M.default;function P(){var e;const{t:s}=(0,r.Bd)(),{schoolId:a,user:P}=(0,l.As)(),[O,L]=(0,i.useState)([]),[Z,H]=(0,i.useState)([]),[D,G]=(0,i.useState)([]),[W,U]=(0,i.useState)({}),[X,V]=(0,i.useState)(E),[K,Y]=(0,i.useState)([]),[q,Q]=(0,i.useState)([]),[ee,se]=(0,i.useState)(!0),[ae,te]=(0,i.useState)(!1),[ie,re]=(0,i.useState)(!1),[le,de]=(0,i.useState)("class"),[ne,ce]=(0,i.useState)(null),[oe,me]=(0,i.useState)(null),[he,xe]=(0,i.useState)((new Date).toISOString().split("T")[0]),[ue,pe]=(0,i.useState)(!1),[be,je]=(0,i.useState)(!1),[ge,ve]=(0,i.useState)(!1),[fe,_e]=(0,i.useState)(!1),[Ne,ye]=(0,i.useState)([]),[we,Ae]=(0,i.useState)(""),[ke,Ce]=(0,i.useState)({day:"",period:"",subject_id:"",teacher_id:"",room:""}),[Se,Re]=(0,i.useState)({class_id:"",period_id:"",original_teacher_id:"",substitute_teacher_id:"",reason:"",is_homeroom:!1}),Je=localStorage.getItem("token"),Be={Authorization:"Bearer ".concat(Je)},Ie=(e=>{const s=(0,t.A)((0,t.A)({},E),e),a=[];let[i,r]=s.school_start_time.split(":").map(Number),l=1;for(let t=0;t<s.periods_per_day;t++){if(l-1===s.break_after_period){const e=r+s.break_duration,t=i+Math.floor(e/60);a.push({id:"break-".concat(l),label:"Break / \u0905\u0935\u0915\u093e\u0936",isBreak:!0,start:"".concat(String(i).padStart(2,"0"),":").concat(String(r).padStart(2,"0")),end:"".concat(String(t).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))}),i=t,r=e%60}if(l-1===s.lunch_after_period){const e=r+s.lunch_duration,t=i+Math.floor(e/60);a.push({id:"lunch-".concat(l),label:"Lunch / \u092d\u094b\u091c\u0928",isBreak:!0,start:"".concat(String(i).padStart(2,"0"),":").concat(String(r).padStart(2,"0")),end:"".concat(String(t).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))}),i=t,r=e%60}const e=r+(1===l?s.normal_period_duration+s.first_period_extra_mins:s.normal_period_duration),t=i+Math.floor(e/60);a.push({id:l,label:"Period ".concat(l),isBreak:!1,start:"".concat(String(i).padStart(2,"0"),":").concat(String(r).padStart(2,"0")),end:"".concat(String(t).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))}),i=t,r=e%60,l++}return a})(X),$e=Ie.filter(e=>!e.isBreak),ze=X.working_days||z,Te=(0,i.useCallback)(async()=>{if(a){se(!0);try{var e;const[s,i,r,l,d,n]=await Promise.all([B.A.get("".concat($,"/classes?school_id=").concat(a),{headers:Be}).catch(()=>({data:[]})),B.A.get("".concat($,"/staff?school_id=").concat(a),{headers:Be}).catch(()=>({data:[]})),B.A.get("".concat($,"/subjects?school_id=").concat(a),{headers:Be}).catch(()=>({data:[]})),B.A.get("".concat($,"/timetables?school_id=").concat(a),{headers:Be}).catch(()=>({data:{}})),B.A.get("".concat($,"/timetable-settings?school_id=").concat(a),{headers:Be}).catch(()=>({data:null})),B.A.get("".concat($,"/subject-allocations?school_id=").concat(a),{headers:Be}).catch(()=>({data:[]}))]),c=s.data||[];L(c),H((i.data||[]).filter(e=>{var s;return"teacher"===e.role||(null===(s=e.designation)||void 0===s?void 0:s.toLowerCase().includes("teacher"))}));const o=[{id:"hindi",name:"Hindi",name_hi:"\u0939\u093f\u0902\u0926\u0940"},{id:"english",name:"English",name_hi:"\u0905\u0902\u0917\u094d\u0930\u0947\u091c\u0940"},{id:"math",name:"Mathematics",name_hi:"\u0917\u0923\u093f\u0924"},{id:"science",name:"Science",name_hi:"\u0935\u093f\u091c\u094d\u091e\u093e\u0928"},{id:"sst",name:"Social Science",name_hi:"\u0938\u093e\u092e\u093e\u091c\u093f\u0915 \u0935\u093f\u091c\u094d\u091e\u093e\u0928"},{id:"computer",name:"Computer",name_hi:"\u0915\u0902\u092a\u094d\u092f\u0942\u091f\u0930"},{id:"pe",name:"Physical Education",name_hi:"\u0936\u093e\u0930\u0940\u0930\u093f\u0915 \u0936\u093f\u0915\u094d\u0937\u093e"},{id:"drawing",name:"Drawing",name_hi:"\u091a\u093f\u0924\u094d\u0930\u0915\u0932\u093e"},{id:"music",name:"Music",name_hi:"\u0938\u0902\u0917\u0940\u0924"},{id:"gk",name:"GK",name_hi:"\u0938\u093e\u092e\u093e\u0928\u094d\u092f \u091c\u094d\u091e\u093e\u0928"},{id:"moral",name:"Moral Science",name_hi:"\u0928\u0948\u0924\u093f\u0915 \u0936\u093f\u0915\u094d\u0937\u093e"},{id:"sanskrit",name:"Sanskrit",name_hi:"\u0938\u0902\u0938\u094d\u0915\u0943\u0924"}];G((null===(e=r.data)||void 0===e?void 0:e.length)>0?r.data:o),U(l.data||{}),d.data&&Object.keys(d.data).length>0&&V(e=>(0,t.A)((0,t.A)({},e),d.data)),Q(n.data||[]),c.length>0&&!ne&&ce(c[0])}catch(s){console.error("Error fetching data:",s),J.oR.error("Failed to load data")}finally{se(!1)}}},[a]),Me=(0,i.useCallback)(async()=>{if(a)try{const e=await B.A.get("".concat($,"/substitutions?school_id=").concat(a,"&date=").concat(he),{headers:Be}).catch(()=>({data:[]}));Y(e.data||[])}catch(e){Y([])}},[a,he]);(0,i.useEffect)(()=>{Te()},[Te]),(0,i.useEffect)(()=>{Me()},[Me]);const Ee=e=>{if(!e)return null;const s=e.class_teacher_id||e.classTeacherId;if(s){const a=Z.find(e=>e.id===s||e._id===s);if(a){const s=q.find(s=>(s.teacher_id===a.id||s.teacher_id===a._id)&&(s.class_id===e.id||s.class_id===e._id));return{teacher:a,subjectName:(null===s||void 0===s?void 0:s.subject_name)||a.subject||null,subjectId:(null===s||void 0===s?void 0:s.subject_id)||null}}}if(e.class_teacher){const s=Z.find(s=>s.name===e.class_teacher);if(s)return{teacher:s,subjectName:s.subject||null,subjectId:null}}return null},Fe=(e,s,a)=>{for(const[l,d]of Object.entries(W)){var t,i,r;if((null===(t=d[s])||void 0===t||null===(i=t[a])||void 0===i?void 0:i.teacher_id)===e&&(null===ne||void 0===ne?void 0:ne.id)!==l)return(null===(r=O.find(e=>e.id===l))||void 0===r?void 0:r.name)||"Another class"}return null};if(!a)return(0,I.jsx)("div",{className:"text-center py-20",children:(0,I.jsx)("p",{className:"text-slate-500",children:s("select_class")})});const Pe=W[null===ne||void 0===ne?void 0:ne.id]||{},Oe=ne?Ee(ne):null;return(0,I.jsxs)("div",{className:"space-y-6","data-testid":"timetable-management",children:[(0,I.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,I.jsxs)("div",{children:[(0,I.jsxs)("h1",{className:"text-3xl font-bold font-heading text-slate-900 flex items-center gap-2",children:[(0,I.jsx)(v.A,{className:"w-8 h-8 text-indigo-600"}),s("timetable")]}),(0,I.jsx)("p",{className:"text-slate-500 mt-1",children:s("view_timetable")})]}),(0,I.jsx)("div",{className:"flex gap-2",children:"class"===le&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(d.$,{onClick:async()=>{if(ne){re(!0);try{try{var e;const s=await B.A.post("".concat($,"/timetable/generate"),{school_id:a,class_id:ne.id||ne._id},{headers:Be});if(null!==(e=s.data)&&void 0!==e&&e.timetable)return U(e=>(0,t.A)((0,t.A)({},e),{},{[ne.id||ne._id]:s.data.timetable})),J.oR.success("Timetable generated!"),void re(!1)}catch(s){}const r=ne.id||ne._id,l=Ee(ne),d=D.filter(e=>e.id&&e.name),n={};ze.forEach(e=>{n[e]={};const s=[...d].sort(()=>Math.random()-.5);let a=0;$e.forEach(t=>{if(1===t.id&&null!==l&&void 0!==l&&l.teacher)return void(n[e][1]={subject_id:"homeroom",subject_name:"Homeroom",teacher_id:l.teacher.id||l.teacher._id,teacher_name:l.teacher.name,room:"",is_homeroom:!0});const i=s[a%s.length];a++;const d=Z.find(e=>q.find(s=>(s.teacher_id===e.id||s.teacher_id===e._id)&&s.class_id===r&&(s.subject_name===(null===i||void 0===i?void 0:i.name)||s.subject_id===(null===i||void 0===i?void 0:i.id))))||Z[Math.floor(Math.random()*(Z.length||1))]||null;i&&(n[e][t.id]={subject_id:i.id,subject_name:i.name,teacher_id:(null===d||void 0===d?void 0:d.id)||"",teacher_name:(null===d||void 0===d?void 0:d.name)||"",room:""})})}),U(e=>(0,t.A)((0,t.A)({},e),{},{[r]:n}));try{await B.A.post("".concat($,"/timetables/bulk"),{school_id:a,class_id:r,timetable:n},{headers:Be})}catch(i){}J.oR.success(null!==l&&void 0!==l&&l.subjectName?"Generated! Class teacher in Period 1 homeroom":"Timetable generated!")}catch(r){J.oR.error("Failed to generate")}finally{re(!1)}}else J.oR.error("Select a class first")},disabled:ie||!ne,className:"gap-2 bg-indigo-600 hover:bg-indigo-700",children:[ie?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(j.A,{className:"w-4 h-4"}),s(ie?"loading":"create_timetable")]}),(0,I.jsxs)(d.$,{variant:"outline",onClick:()=>{const e=document.getElementById("timetable-grid");if(!e)return;const s=window.open("","_blank");s.document.write("<html><head><title>Timetable</title><style>\n      body{font-family:Arial,sans-serif;padding:20px}\n      h1{text-align:center}table{width:100%;border-collapse:collapse;margin-top:20px}\n      th,td{border:1px solid #ddd;padding:8px;text-align:center;font-size:11px}\n      th{background:#f5f5f5;font-weight:bold}.homeroom{background:#dbeafe}\n      @media print{body{-webkit-print-color-adjust:exact}}\n    </style></head><body>\n      <h1>".concat("class"===le?null===ne||void 0===ne?void 0:ne.name:null===oe||void 0===oe?void 0:oe.name," - Timetable</h1>\n      ").concat(e.outerHTML,"\n      <script>window.onload=()=>window.print();<\/script>\n    </body></html>")),s.document.close()},className:"gap-2",children:[(0,I.jsx)(N.A,{className:"w-4 h-4"})," ",s("print")]})]})})]}),(0,I.jsxs)(h.tU,{value:le,onValueChange:de,className:"w-full",children:[(0,I.jsxs)(h.j7,{className:"grid w-full grid-cols-4 max-w-2xl",children:[(0,I.jsxs)(h.Xi,{value:"class",className:"gap-1.5",children:[(0,I.jsx)(f.A,{className:"w-4 h-4"})," ",s("timetable")]}),(0,I.jsxs)(h.Xi,{value:"teacher",className:"gap-1.5",children:[(0,I.jsx)(S.A,{className:"w-4 h-4"})," ",s("teacher")]}),(0,I.jsxs)(h.Xi,{value:"substitutions",className:"gap-1.5",children:[(0,I.jsx)(y.A,{className:"w-4 h-4"})," ",s("substitution")]}),(0,I.jsxs)(h.Xi,{value:"settings",className:"gap-1.5",children:[(0,I.jsx)(A.A,{className:"w-4 h-4"})," ",s("settings")]})]}),(0,I.jsx)(h.av,{value:"class",className:"mt-4",children:(0,I.jsxs)(m.Zp,{children:[(0,I.jsx)(m.aR,{className:"pb-3",children:(0,I.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,I.jsx)(m.ZB,{children:s("timetable")}),(0,I.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2",children:[(0,I.jsxs)(c.J,{children:[s("select_class"),":"]}),(0,I.jsx)("select",{className:"border rounded-md px-3 py-2 text-sm bg-white min-w-[160px]",value:(null===ne||void 0===ne?void 0:ne.id)||"",onChange:e=>ce(O.find(s=>s.id===e.target.value)),children:O.map(e=>(0,I.jsx)("option",{value:e.id,children:e.name},e.id))})]}),Oe?(0,I.jsxs)("div",{className:"flex items-center gap-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-1.5",children:[(0,I.jsx)(C.A,{className:"w-4 h-4 text-blue-600"}),(0,I.jsxs)("span",{className:"text-sm font-medium text-blue-800",children:[s("class_teacher"),": ",Oe.teacher.name]})]}):(0,I.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>je(!0),className:"gap-1.5 border-amber-300 text-amber-700 hover:bg-amber-50",children:[(0,I.jsx)(x.A,{className:"w-4 h-4"})," ",s("class_teacher")]}),(0,I.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>je(!0),className:"gap-1",children:[(0,I.jsx)(p.A,{className:"w-3.5 h-3.5"})," ",s("edit")]}),(0,I.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>{ye((null===ne||void 0===ne?void 0:ne.subjects)||[]),_e(!0)},className:"gap-1.5 border-indigo-300 text-indigo-700 hover:bg-indigo-50",children:[(0,I.jsx)(b.A,{className:"w-3.5 h-3.5"}),(null===ne||void 0===ne||null===(e=ne.subjects)||void 0===e?void 0:e.length)>0?"".concat(s("subjects")," (").concat(ne.subjects.length,")"):s("subjects")]})]})]})}),(0,I.jsxs)(m.Wu,{children:[ee?(0,I.jsx)("div",{className:"flex justify-center py-20",children:(0,I.jsx)(u.A,{className:"w-8 h-8 animate-spin text-indigo-600"})}):(0,I.jsx)("div",{className:"overflow-x-auto",id:"timetable-grid",children:(0,I.jsxs)("table",{className:"w-full border-collapse min-w-[800px]",children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{className:"border border-slate-200 bg-slate-100 p-2 text-sm font-semibold w-28",children:"Day / \u0926\u093f\u0928"}),Ie.map(e=>(0,I.jsxs)("th",{className:"border border-slate-200 p-2 text-xs font-semibold ".concat(e.isBreak?"bg-amber-50":1===e.id?"bg-blue-100 border-blue-300":"bg-slate-100"),children:[(0,I.jsx)("div",{children:e.label}),(0,I.jsxs)("div",{className:"text-[10px] text-slate-500 font-normal",children:[e.start," - ",e.end]}),1===e.id&&(0,I.jsxs)("span",{className:"inline-block mt-0.5 px-1.5 py-0.5 rounded-full text-[9px] font-bold bg-blue-200 text-blue-700",children:["+",X.first_period_extra_mins," min"]})]},e.id))]})}),(0,I.jsx)("tbody",{children:ze.map((e,a)=>(0,I.jsxs)("tr",{children:[(0,I.jsxs)("td",{className:"border border-slate-200 bg-slate-50 p-2 text-sm font-medium",children:[(0,I.jsx)("div",{children:e}),(0,I.jsx)("div",{className:"text-[10px] text-slate-400",children:T[z.indexOf(e)]})]}),Ie.map(a=>{var t;if(a.isBreak)return(0,I.jsx)("td",{className:"border border-amber-200 bg-amber-50 p-2 text-center",children:(0,I.jsx)("span",{className:"text-xs text-amber-600 font-medium",children:a.label})},a.id);if(1===a.id){var i;const e=(null===Oe||void 0===Oe||null===(i=Oe.teacher)||void 0===i?void 0:i.name)||"Not Assigned";return(0,I.jsx)("td",{className:"border-2 border-blue-300 bg-blue-50 p-2 cursor-not-allowed",title:"Reserved for Class Teacher - Attendance Period (+10 mins)",children:(0,I.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,I.jsx)("span",{className:"text-lg",children:"\ud83d\udc68\u200d\ud83c\udfeb"}),(0,I.jsx)("span",{className:"text-xs font-bold text-blue-800",children:s("homeroom")}),(0,I.jsx)("span",{className:"text-[10px] text-blue-600",children:"\u0909\u092a\u0938\u094d\u0925\u093f\u0924\u093f"}),(0,I.jsx)("span",{className:"text-[10px] text-blue-700 font-medium truncate max-w-[80px]",children:e}),(0,I.jsxs)("span",{className:"inline-block px-1 py-0.5 rounded-full text-[8px] font-bold bg-blue-200 text-blue-700",children:["+",X.first_period_extra_mins," min"]})]})},a.id)}const r=null===(t=Pe[e])||void 0===t?void 0:t[a.id];return(0,I.jsx)("td",{className:"border border-slate-200 p-1.5 text-center cursor-pointer hover:bg-slate-50 transition-colors ".concat(r?F(r.subject_name):""),onClick:()=>((e,s)=>{var a,t;if(1===s.id)return;const i=(null===(a=W[null===ne||void 0===ne?void 0:ne.id])||void 0===a||null===(t=a[e])||void 0===t?void 0:t[s.id])||{};Ce({day:e,period:s.id,subject_id:i.subject_id||"",teacher_id:i.teacher_id||"",room:i.room||""}),pe(!0)})(e,a),children:r?(0,I.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,I.jsx)("span",{className:"text-xs font-semibold",children:r.subject_name}),(0,I.jsx)("span",{className:"text-[10px] text-slate-500",children:r.teacher_name})]}):(0,I.jsxs)("span",{className:"text-slate-300 text-xs",children:["+ ",s("add")]})},a.id)})]},e))})]})}),(0,I.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[Object.keys(M).filter(e=>"default"!==e).map(e=>(0,I.jsx)("span",{className:"px-2 py-0.5 rounded text-[10px] font-medium border ".concat(M[e]),children:e},e)),(0,I.jsxs)("span",{className:"px-2 py-0.5 rounded text-[10px] font-medium border bg-blue-100 border-blue-300 text-blue-800",children:["\ud83c\udfe0 ",s("homeroom")]})]})]})]})}),(0,I.jsx)(h.av,{value:"teacher",className:"mt-4",children:(0,I.jsxs)(m.Zp,{children:[(0,I.jsx)(m.aR,{className:"pb-3",children:(0,I.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,I.jsx)(m.ZB,{children:s("teacher")}),(0,I.jsxs)("div",{className:"flex items-center gap-2",children:[(0,I.jsxs)(c.J,{children:[s("teacher"),":"]}),(0,I.jsxs)("select",{className:"border rounded-md px-3 py-2 text-sm bg-white min-w-[200px]",value:(null===oe||void 0===oe?void 0:oe.id)||"",onChange:e=>me(Z.find(s=>s.id===e.target.value)),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("subject_teacher")," --"]}),Z.map(e=>(0,I.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})}),(0,I.jsx)(m.Wu,{children:oe?(()=>{const e=(e=>{const s={};return Object.entries(W).forEach(a=>{let[i,r]=a;Object.entries(r).forEach(a=>{let[r,l]=a;Object.entries(l).forEach(a=>{let[l,d]=a;var n;d.teacher_id===e&&(s[r]||(s[r]={}),s[r][l]=(0,t.A)((0,t.A)({},d),{},{class_id:i,class_name:null===(n=O.find(e=>e.id===i))||void 0===n?void 0:n.name}))})})}),s})(oe.id),a=O.filter(e=>{const s=e.class_teacher_id||e.classTeacherId;return s===oe.id||s===oe._id||e.class_teacher===oe.name});return(0,I.jsxs)("div",{children:[a.length>0&&(0,I.jsx)("div",{className:"mb-3 flex gap-2 flex-wrap",children:a.map(e=>(0,I.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 border border-blue-200",children:[s("class_teacher"),": ",e.name]},e.id))}),(0,I.jsx)("div",{className:"overflow-x-auto",children:(0,I.jsxs)("table",{className:"w-full border-collapse min-w-[800px]",children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{children:[(0,I.jsx)("th",{className:"border border-slate-200 bg-slate-100 p-2 text-sm font-semibold w-28",children:s("date")}),$e.map(e=>(0,I.jsxs)("th",{className:"border border-slate-200 p-2 text-xs font-semibold ".concat(1===e.id?"bg-blue-100 border-blue-300":"bg-slate-100"),children:[(0,I.jsx)("div",{children:e.label}),(0,I.jsxs)("div",{className:"text-[10px] text-slate-500",children:[e.start,"-",e.end]}),1===e.id&&(0,I.jsxs)("span",{className:"inline-block mt-0.5 px-1 rounded-full text-[9px] font-bold bg-blue-200 text-blue-700",children:["+",X.first_period_extra_mins,"m"]})]},e.id))]})}),(0,I.jsx)("tbody",{children:ze.map((t,i)=>(0,I.jsxs)("tr",{children:[(0,I.jsxs)("td",{className:"border border-slate-200 bg-slate-50 p-2 text-sm font-medium",children:[(0,I.jsx)("div",{children:t}),(0,I.jsx)("div",{className:"text-[10px] text-slate-400",children:T[z.indexOf(t)]})]}),$e.map(i=>{var r;const l=null===(r=e[t])||void 0===r?void 0:r[i.id];return 1===i.id&&a.length>0?(0,I.jsx)("td",{className:"border-2 border-blue-300 bg-blue-50 p-2",children:(0,I.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,I.jsx)("span",{className:"text-lg",children:"\ud83d\udc68\u200d\ud83c\udfeb"}),(0,I.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[9px] font-bold bg-blue-600 text-white",children:s("homeroom")}),(0,I.jsx)("span",{className:"text-[10px] text-blue-700",children:a.map(e=>e.name).join(", ")})]})},i.id):(0,I.jsx)("td",{className:"border border-slate-200 p-1.5 text-center ".concat(l?F(l.subject_name):"bg-green-50"),children:l?(0,I.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,I.jsx)("span",{className:"text-xs font-semibold",children:l.subject_name}),(0,I.jsx)("span",{className:"text-[10px] text-slate-500",children:l.class_name})]}):(0,I.jsx)("span",{className:"text-green-500 text-xs font-medium",children:s("available")})},i.id)})]},t))})]})})]})})():(0,I.jsxs)("div",{className:"text-center py-12 text-slate-400",children:[(0,I.jsx)(R.A,{className:"w-12 h-12 mx-auto mb-3 opacity-40"}),(0,I.jsx)("p",{children:s("subject_teacher")})]})})]})}),(0,I.jsx)(h.av,{value:"substitutions",className:"mt-4",children:(0,I.jsxs)(m.Zp,{children:[(0,I.jsx)(m.aR,{className:"pb-3",children:(0,I.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,I.jsx)(m.ZB,{children:s("substitution")}),(0,I.jsxs)("div",{className:"flex items-center gap-3",children:[(0,I.jsx)(n.p,{type:"date",value:he,onChange:e=>xe(e.target.value),className:"w-40"}),(0,I.jsxs)(d.$,{onClick:()=>{Re({class_id:"",period_id:"",original_teacher_id:"",substitute_teacher_id:"",reason:"",is_homeroom:!1}),ve(!0)},className:"gap-1.5 bg-indigo-600 hover:bg-indigo-700",children:[(0,I.jsx)(_.A,{className:"w-4 h-4"})," ",s("assign_substitute")]})]})]})}),(0,I.jsx)(m.Wu,{children:0===K.length?(0,I.jsxs)("div",{className:"text-center py-12 text-slate-400",children:[(0,I.jsx)(y.A,{className:"w-12 h-12 mx-auto mb-3 opacity-40"}),(0,I.jsx)("p",{children:s("no_data")})]}):(0,I.jsx)("div",{className:"overflow-x-auto",children:(0,I.jsxs)("table",{className:"w-full border-collapse",children:[(0,I.jsx)("thead",{children:(0,I.jsxs)("tr",{className:"bg-slate-50",children:[(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-left",children:s("classes")}),(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-left",children:s("period")}),(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-left",children:s("teacher")}),(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-left",children:s("substitution")}),(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-left",children:s("reason")}),(0,I.jsx)("th",{className:"border border-slate-200 p-2 text-sm text-center w-20",children:s("actions")})]})}),(0,I.jsx)("tbody",{children:K.map(e=>{const a=O.find(s=>s.id===e.class_id),t=Z.find(s=>s.id===e.original_teacher_id),i=Z.find(s=>s.id===e.substitute_teacher_id);return(0,I.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,I.jsx)("td",{className:"border border-slate-200 p-2 text-sm",children:(null===a||void 0===a?void 0:a.name)||e.class_id}),(0,I.jsxs)("td",{className:"border border-slate-200 p-2 text-sm",children:[s("period")," ",e.period_id,(e.is_homeroom||1===e.period_id)&&(0,I.jsx)("span",{className:"ml-1 px-1.5 py-0.5 rounded text-[9px] font-bold bg-blue-100 text-blue-700",children:s("homeroom")})]}),(0,I.jsx)("td",{className:"border border-slate-200 p-2 text-sm",children:(null===t||void 0===t?void 0:t.name)||e.original_teacher_name||"-"}),(0,I.jsx)("td",{className:"border border-slate-200 p-2 text-sm font-medium text-green-700",children:(null===i||void 0===i?void 0:i.name)||e.substitute_teacher_name||"-"}),(0,I.jsx)("td",{className:"border border-slate-200 p-2 text-sm text-slate-500",children:e.reason||"-"}),(0,I.jsx)("td",{className:"border border-slate-200 p-2 text-center",children:(0,I.jsx)(d.$,{size:"sm",variant:"ghost",className:"text-red-500 hover:text-red-700 h-7 w-7 p-0",onClick:()=>(async e=>{try{await B.A.delete("".concat($,"/substitutions/").concat(e),{headers:Be}),J.oR.success("Substitution removed"),Me()}catch(s){J.oR.error("Failed to remove")}})(e.id||e._id),children:(0,I.jsx)(k.A,{className:"w-3.5 h-3.5"})})})]},e.id||e._id)})})]})})})]})}),(0,I.jsx)(h.av,{value:"settings",className:"mt-4",children:(0,I.jsxs)(m.Zp,{children:[(0,I.jsx)(m.aR,{children:(0,I.jsxs)(m.ZB,{className:"flex items-center gap-2",children:[(0,I.jsx)(A.A,{className:"w-5 h-5"})," ",s("settings")]})}),(0,I.jsxs)(m.Wu,{children:[(0,I.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,I.jsxs)("div",{className:"space-y-4",children:[(0,I.jsxs)("div",{children:[(0,I.jsxs)(c.J,{children:[s("period")," (",s("time_slot"),")"]}),(0,I.jsx)(n.p,{type:"number",min:20,max:90,value:X.normal_period_duration,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{normal_period_duration:parseInt(e.target.value)||40}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("start_time")}),(0,I.jsx)(n.p,{type:"number",min:0,max:30,value:X.first_period_extra_mins,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{first_period_extra_mins:parseInt(e.target.value)||10}))}),(0,I.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:["Period 1 = ",X.normal_period_duration+X.first_period_extra_mins," mins (Homeroom / \u0909\u092a\u0938\u094d\u0925\u093f\u0924\u093f)"]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("start_time")}),(0,I.jsx)(n.p,{type:"time",value:X.school_start_time,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{school_start_time:e.target.value}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("period")}),(0,I.jsx)(n.p,{type:"number",min:4,max:12,value:X.periods_per_day,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{periods_per_day:parseInt(e.target.value)||8}))})]})]}),(0,I.jsxs)("div",{className:"space-y-4",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("break_time")}),(0,I.jsx)(n.p,{type:"number",min:5,max:30,value:X.break_duration,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{break_duration:parseInt(e.target.value)||15}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("lunch")}),(0,I.jsx)(n.p,{type:"number",min:15,max:60,value:X.lunch_duration,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{lunch_duration:parseInt(e.target.value)||30}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("break_time")}),(0,I.jsx)(n.p,{type:"number",min:1,max:10,value:X.break_after_period,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{break_after_period:parseInt(e.target.value)||3}))})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("lunch")}),(0,I.jsx)(n.p,{type:"number",min:1,max:10,value:X.lunch_after_period,onChange:e=>V(s=>(0,t.A)((0,t.A)({},s),{},{lunch_after_period:parseInt(e.target.value)||5}))})]})]})]}),(0,I.jsxs)("div",{className:"mt-6",children:[(0,I.jsx)(c.J,{className:"mb-2 block",children:s("working_days")}),(0,I.jsx)("div",{className:"flex flex-wrap gap-3",children:z.map((e,s)=>{var a;return(0,I.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,I.jsx)("input",{type:"checkbox",checked:null===(a=X.working_days)||void 0===a?void 0:a.includes(e),onChange:s=>{V(a=>(0,t.A)((0,t.A)({},a),{},{working_days:s.target.checked?[...a.working_days||[],e]:(a.working_days||[]).filter(s=>s!==e)}))},className:"rounded border-slate-300"}),(0,I.jsxs)("span",{className:"text-sm",children:[e," ",(0,I.jsxs)("span",{className:"text-slate-400 text-xs",children:["(",T[s],")"]})]})]},e)})})]}),(0,I.jsx)("div",{className:"mt-6",children:(0,I.jsxs)(d.$,{onClick:async()=>{te(!0);try{await B.A.post("".concat($,"/timetable-settings"),(0,t.A)({school_id:a},X),{headers:Be}),J.oR.success("Settings saved!")}catch(e){J.oR.error("Failed to save settings")}finally{te(!1)}},disabled:ae,className:"gap-2 bg-indigo-600 hover:bg-indigo-700",children:[ae?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(w.A,{className:"w-4 h-4"}),s("save_settings")]})}),(0,I.jsxs)("div",{className:"mt-8 border-t pt-6",children:[(0,I.jsx)("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:s("time_slot")}),(0,I.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:Ie.map(e=>(0,I.jsxs)("div",{className:"p-2 rounded-lg border text-center text-xs ".concat(e.isBreak?"bg-amber-50 border-amber-200":1===e.id?"bg-blue-50 border-blue-200":"bg-white border-slate-200"),children:[(0,I.jsx)("div",{className:"font-medium",children:e.label}),(0,I.jsxs)("div",{className:"text-slate-500",children:[e.start," - ",e.end]}),1===e.id&&(0,I.jsxs)("span",{className:"text-[9px] text-blue-600 font-bold",children:[s("homeroom")," +",X.first_period_extra_mins,"m"]})]},e.id))})]})]})]})})]}),(0,I.jsx)(o.lG,{open:ue,onOpenChange:pe,children:(0,I.jsxs)(o.Cf,{className:"max-w-md",children:[(0,I.jsxs)(o.c7,{children:[(0,I.jsx)(o.L3,{children:s("period")}),(0,I.jsxs)(o.rr,{children:[ke.day," - ",s("period")," ",ke.period]})]}),(0,I.jsxs)("div",{className:"space-y-4",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("subject")}),(!(null!==ne&&void 0!==ne&&ne.subjects)||0===ne.subjects.length)&&(0,I.jsxs)("p",{className:"text-xs text-amber-600 mb-1 flex items-center gap-1",children:[(0,I.jsx)(x.A,{className:"w-3 h-3"}),'\u0938\u092d\u0940 \u0935\u093f\u0937\u092f \u0926\u093f\u0916 \u0930\u0939\u0947 \u0939\u0948\u0902\u0964 \u0915\u0915\u094d\u0937\u093e \u0915\u0947 \u0935\u093f\u0937\u092f \u0938\u0947\u091f \u0915\u0930\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f "Assign Subjects" \u092c\u091f\u0928 \u0926\u092c\u093e\u090f\u0902\u0964']}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:ke.subject_id,onChange:e=>Ce(s=>(0,t.A)((0,t.A)({},s),{},{subject_id:e.target.value})),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("subject")," --"]}),(()=>{if(!ne)return D;const e=ne.subjects;return e&&e.length>0?D.filter(s=>e.includes(s.id)):D})().map(e=>(0,I.jsxs)("option",{value:e.id,children:[e.name,e.name_hi?" (".concat(e.name_hi,")"):""]},e.id))]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("teacher")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:ke.teacher_id,onChange:e=>Ce(s=>(0,t.A)((0,t.A)({},s),{},{teacher_id:e.target.value})),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("teacher")," --"]}),Z.map(e=>{const s=Fe(e.id,ke.day,ke.period);return(0,I.jsxs)("option",{value:e.id,disabled:!!s,children:[e.name,s?" (Busy: ".concat(s,")"):""]},e.id)})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsxs)(c.J,{children:[s("room_number")," (",s("optional"),")"]}),(0,I.jsx)(n.p,{value:ke.room,onChange:e=>Ce(s=>(0,t.A)((0,t.A)({},s),{},{room:e.target.value})),placeholder:"Room number"})]}),(0,I.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,I.jsxs)(d.$,{variant:"destructive",size:"sm",onClick:async()=>{te(!0);try{await B.A.delete("".concat($,"/timetables/slot"),{headers:Be,data:{school_id:a,class_id:ne.id,day:ke.day,period_id:ke.period}}),U(e=>{var s;const a=(0,t.A)({},e);return null!==(s=a[ne.id])&&void 0!==s&&s[ke.day]&&delete a[ne.id][ke.day][ke.period],a}),J.oR.success("Period removed"),pe(!1)}catch(e){J.oR.error("Failed to remove")}finally{te(!1)}},disabled:ae,className:"gap-1",children:[(0,I.jsx)(k.A,{className:"w-3.5 h-3.5"})," ",s("delete")]}),(0,I.jsx)("div",{className:"flex-1"}),(0,I.jsx)(d.$,{variant:"outline",onClick:()=>pe(!1),children:s("cancel")}),(0,I.jsxs)(d.$,{onClick:async()=>{if(ke.subject_id){if(ke.teacher_id){const e=Fe(ke.teacher_id,ke.day,ke.period);if(e)return void J.oR.error("Teacher already busy in ".concat(e))}te(!0);try{const e=D.find(e=>e.id===ke.subject_id),s=Z.find(e=>e.id===ke.teacher_id);await B.A.post("".concat($,"/timetables/slot"),{school_id:a,class_id:ne.id,day:ke.day,period_id:ke.period,subject_id:ke.subject_id,subject_name:null===e||void 0===e?void 0:e.name,teacher_id:ke.teacher_id,teacher_name:null===s||void 0===s?void 0:s.name,room:ke.room},{headers:Be}),U(a=>{var i;return(0,t.A)((0,t.A)({},a),{},{[ne.id]:(0,t.A)((0,t.A)({},a[ne.id]),{},{[ke.day]:(0,t.A)((0,t.A)({},null===(i=a[ne.id])||void 0===i?void 0:i[ke.day]),{},{[ke.period]:{subject_id:ke.subject_id,subject_name:null===e||void 0===e?void 0:e.name,teacher_id:ke.teacher_id,teacher_name:null===s||void 0===s?void 0:s.name,room:ke.room}})})})}),J.oR.success("Period saved!"),pe(!1)}catch(i){var e,s;J.oR.error((null===(e=i.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.detail)||"Failed to save period")}finally{te(!1)}}else J.oR.error("Please select a subject")},disabled:ae,className:"bg-indigo-600 hover:bg-indigo-700 gap-1",children:[ae?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(w.A,{className:"w-4 h-4"})," ",s("save")]})]})]})]})}),(0,I.jsx)(o.lG,{open:be,onOpenChange:je,children:(0,I.jsxs)(o.Cf,{className:"max-w-md",children:[(0,I.jsxs)(o.c7,{children:[(0,I.jsx)(o.L3,{children:s("class_teacher")}),(0,I.jsxs)(o.rr,{children:[null===ne||void 0===ne?void 0:ne.name," - Assigning will auto-create Period 1 Homeroom entries"]})]}),(0,I.jsxs)("div",{className:"space-y-4",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("teacher")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:we,onChange:e=>Ae(e.target.value),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("teacher")," --"]}),Z.map(e=>(0,I.jsxs)("option",{value:e.id,children:[e.name,e.subject?" (".concat(e.subject,")"):""]},e.id))]})]}),(0,I.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,I.jsxs)("p",{className:"text-xs text-blue-700",children:[(0,I.jsx)("strong",{children:"Note:"}),' Assigning a class teacher will automatically lock Period 1 as "Homeroom / \u0909\u092a\u0938\u094d\u0925\u093f\u0924\u093f" for all working days. This period has +',X.first_period_extra_mins," extra minutes for attendance."]})}),(0,I.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,I.jsx)(d.$,{variant:"outline",onClick:()=>je(!1),children:s("cancel")}),(0,I.jsxs)(d.$,{onClick:async()=>{if(we&&ne){te(!0);try{await B.A.post("".concat($,"/class-teacher/assign"),{school_id:a,class_id:ne.id,teacher_id:we},{headers:Be}),J.oR.success("Class teacher assigned! Homeroom entries created."),je(!1),Ae(""),Te()}catch(t){var e,s;J.oR.error((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.detail)||"Failed to assign class teacher")}finally{te(!1)}}},disabled:ae||!we,className:"bg-indigo-600 hover:bg-indigo-700 gap-1",children:[ae?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(C.A,{className:"w-4 h-4"})," ",s("save")]})]})]})]})}),(0,I.jsx)(o.lG,{open:ge,onOpenChange:ve,children:(0,I.jsxs)(o.Cf,{className:"max-w-md",children:[(0,I.jsxs)(o.c7,{children:[(0,I.jsx)(o.L3,{children:s("substitution")}),(0,I.jsxs)(o.rr,{children:["Date: ",he]})]}),(0,I.jsxs)("div",{className:"space-y-4",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("classes")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:Se.class_id,onChange:e=>{const s=e.target.value;Re(e=>(0,t.A)((0,t.A)({},e),{},{class_id:s,period_id:"",original_teacher_id:""}))},children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("select_class")," --"]}),O.map(e=>(0,I.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("period")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:Se.period_id,onChange:e=>{var s,a;const i=e.target.value,r=null===(s=W[Se.class_id])||void 0===s||null===(a=s[ze[0]])||void 0===a?void 0:a[parseInt(i)];Re(e=>(0,t.A)((0,t.A)({},e),{},{period_id:i,original_teacher_id:(null===r||void 0===r?void 0:r.teacher_id)||"",is_homeroom:"1"===i}))},children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("period")," --"]}),$e.map(e=>(0,I.jsxs)("option",{value:e.id,children:[s("period")," ",e.id,1===e.id?" (".concat(s("homeroom"),")"):""]},e.id))]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("teacher")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:Se.original_teacher_id,onChange:e=>Re(s=>(0,t.A)((0,t.A)({},s),{},{original_teacher_id:e.target.value})),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("teacher")," --"]}),Z.map(e=>(0,I.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("substitution")}),(0,I.jsxs)("select",{className:"w-full border rounded-md px-3 py-2 text-sm bg-white",value:Se.substitute_teacher_id,onChange:e=>Re(s=>(0,t.A)((0,t.A)({},s),{},{substitute_teacher_id:e.target.value})),children:[(0,I.jsxs)("option",{value:"",children:["-- ",s("assign_substitute")," --"]}),Z.filter(e=>e.id!==Se.original_teacher_id).map(e=>{const s=Se.period_id?Fe(e.id,ze[0],parseInt(Se.period_id)):null;return(0,I.jsxs)("option",{value:e.id,disabled:!!s,children:[e.name,s?" (Busy: ".concat(s,")"):""]},e.id)})]})]}),(0,I.jsxs)("div",{children:[(0,I.jsx)(c.J,{children:s("reason")}),(0,I.jsx)(n.p,{value:Se.reason,onChange:e=>Re(s=>(0,t.A)((0,t.A)({},s),{},{reason:e.target.value})),placeholder:s("reason")})]}),(0,I.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,I.jsx)(d.$,{variant:"outline",onClick:()=>ve(!1),children:s("cancel")}),(0,I.jsxs)(d.$,{onClick:async()=>{if(Se.class_id&&Se.period_id&&Se.substitute_teacher_id){te(!0);try{await B.A.post("".concat($,"/substitutions"),{school_id:a,class_id:Se.class_id,date:he,period_id:parseInt(Se.period_id),original_teacher_id:Se.original_teacher_id,substitute_teacher_id:Se.substitute_teacher_id,reason:Se.reason,is_homeroom:"1"===Se.period_id||1===Se.period_id},{headers:Be}),J.oR.success("Substitution added!"),ve(!1),Re({class_id:"",period_id:"",original_teacher_id:"",substitute_teacher_id:"",reason:"",is_homeroom:!1}),Me()}catch(t){var e,s;J.oR.error((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.detail)||"Failed to add substitution")}finally{te(!1)}}else J.oR.error("Please fill all required fields")},disabled:ae,className:"bg-indigo-600 hover:bg-indigo-700 gap-1",children:[ae?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(g.A,{className:"w-4 h-4"})," ",s("save")]})]})]})]})}),(0,I.jsx)(o.lG,{open:fe,onOpenChange:_e,children:(0,I.jsxs)(o.Cf,{className:"max-w-lg",children:[(0,I.jsxs)(o.c7,{children:[(0,I.jsxs)(o.L3,{children:[s("subjects")," - ",null===ne||void 0===ne?void 0:ne.name]}),(0,I.jsx)(o.rr,{children:"\u0907\u0938 \u0915\u0915\u094d\u0937\u093e \u092e\u0947\u0902 \u092a\u0922\u093c\u093e\u090f \u091c\u093e\u0928\u0947 \u0935\u093e\u0932\u0947 \u0935\u093f\u0937\u092f \u091a\u0941\u0928\u0947\u0902\u0964 \u0915\u0947\u0935\u0932 \u091a\u0941\u0928\u0947 \u0939\u0941\u090f \u0935\u093f\u0937\u092f \u0939\u0940 \u091f\u093e\u0907\u092e\u091f\u0947\u092c\u0932 \u092e\u0947\u0902 \u0926\u093f\u0916\u0947\u0902\u0917\u0947\u0964"})]}),(0,I.jsx)("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:D.map(e=>(0,I.jsxs)("label",{className:"flex items-center gap-3 p-2.5 rounded-lg border cursor-pointer transition-colors ".concat(Ne.includes(e.id)?"bg-indigo-50 border-indigo-300":"bg-white border-slate-200 hover:bg-slate-50"),children:[(0,I.jsx)("input",{type:"checkbox",checked:Ne.includes(e.id),onChange:()=>{return s=e.id,void ye(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"w-4 h-4 text-indigo-600 rounded"}),(0,I.jsxs)("div",{className:"flex-1",children:[(0,I.jsx)("span",{className:"text-sm font-medium",children:e.name}),e.name_hi&&(0,I.jsxs)("span",{className:"text-xs text-slate-500 ml-2",children:["(",e.name_hi,")"]})]}),Ne.includes(e.id)&&(0,I.jsx)(g.A,{className:"w-4 h-4 text-indigo-600"})]},e.id))}),(0,I.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t",children:[(0,I.jsxs)("p",{className:"text-xs text-slate-500",children:[Ne.length," \u0935\u093f\u0937\u092f \u091a\u0941\u0928\u0947 \u0917\u090f / ",Ne.length," subjects selected"]}),(0,I.jsxs)("div",{className:"flex gap-2",children:[(0,I.jsx)(d.$,{variant:"outline",onClick:()=>_e(!1),children:s("cancel")}),(0,I.jsxs)(d.$,{onClick:async()=>{if(ne){te(!0);try{await B.A.put("".concat($,"/classes/").concat(ne.id,"/subjects"),{subjects:Ne},{headers:Be}),L(e=>e.map(e=>e.id===ne.id?(0,t.A)((0,t.A)({},e),{},{subjects:Ne}):e)),ce(e=>(0,t.A)((0,t.A)({},e),{},{subjects:Ne})),J.oR.success("Subjects assigned successfully! / \u0935\u093f\u0937\u092f \u0938\u092b\u0932\u0924\u093e\u092a\u0942\u0930\u094d\u0935\u0915 \u091c\u094b\u0921\u093c\u0947 \u0917\u090f!"),_e(!1)}catch(e){J.oR.error("Failed to save subjects")}finally{te(!1)}}},disabled:ae||0===Ne.length,className:"bg-indigo-600 hover:bg-indigo-700 gap-1",children:[ae?(0,I.jsx)(u.A,{className:"w-4 h-4 animate-spin"}):(0,I.jsx)(w.A,{className:"w-4 h-4"})," ",s("save")]})]})]})]})})]})}}}]);