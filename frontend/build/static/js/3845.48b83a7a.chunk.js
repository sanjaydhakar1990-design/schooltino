"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3845],{1111(e,s,a){a.d(s,{$:()=>h});var t=a(2555),l=a(3986),i=a(9950),n=a(2962),r=a(4364),o=a(9332),d=a(4414);const c=["className","variant","size","asChild"],m=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-blue-500 text-white shadow-sm hover:bg-blue-600 rounded-lg",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-gray-200 bg-white shadow-sm hover:bg-gray-50 text-gray-700 rounded-lg",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=i.forwardRef((e,s)=>{let{className:a,variant:i,size:r,asChild:h=!1}=e,x=(0,l.A)(e,c);const u=h?n.DX:"button";return(0,d.jsx)(u,(0,t.A)({className:(0,o.cn)(m({variant:i,size:r,className:a})),ref:s},x))});h.displayName="Button"},7255(e,s,a){a.d(s,{Cf:()=>j,L3:()=>N,c7:()=>v,lG:()=>g,rr:()=>y,zM:()=>b});var t=a(2555),l=a(3986),i=a(9950),n=a(9710),r=a(6479),o=a(9332),d=a(4414);const c=["className"],m=["className","children"],h=["className"],x=["className"],u=["className"],g=n.bL,b=n.l9,p=n.ZL,f=(n.bm,i.forwardRef((e,s)=>{let{className:a}=e,i=(0,l.A)(e,c);return(0,d.jsx)(n.hJ,(0,t.A)({ref:s,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a)},i))}));f.displayName=n.hJ.displayName;const j=i.forwardRef((e,s)=>{let{className:a,children:i}=e,c=(0,l.A)(e,m);return(0,d.jsxs)(p,{children:[(0,d.jsx)(f,{}),(0,d.jsxs)(n.UC,(0,t.A)((0,t.A)({ref:s,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a)},c),{},{children:[i,(0,d.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,d.jsx)(r.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});j.displayName=n.UC.displayName;const v=e=>{let{className:s}=e,a=(0,l.A)(e,h);return(0,d.jsx)("div",(0,t.A)({className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s)},a))};v.displayName="DialogHeader";const N=i.forwardRef((e,s)=>{let{className:a}=e,i=(0,l.A)(e,x);return(0,d.jsx)(n.hE,(0,t.A)({ref:s,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",a)},i))});N.displayName=n.hE.displayName;const y=i.forwardRef((e,s)=>{let{className:a}=e,i=(0,l.A)(e,u);return(0,d.jsx)(n.VY,(0,t.A)({ref:s,className:(0,o.cn)("text-sm text-muted-foreground",a)},i))});y.displayName=n.VY.displayName},4779(e,s,a){a.d(s,{p:()=>d});var t=a(2555),l=a(3986),i=a(9950),n=a(9332),r=a(4414);const o=["className","type"],d=i.forwardRef((e,s)=>{let{className:a,type:i}=e,d=(0,l.A)(e,o);return(0,r.jsx)("input",(0,t.A)({type:i,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s},d))});d.displayName="Input"},557(e,s,a){a.d(s,{J:()=>h});var t=a(2555),l=a(3986),i=a(9950),n=a(1611),r=a(4364),o=a(9332),d=a(4414);const c=["className"],m=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),h=i.forwardRef((e,s)=>{let{className:a}=e,i=(0,l.A)(e,c);return(0,d.jsx)(n.b,(0,t.A)({ref:s,className:(0,o.cn)(m(),a)},i))});h.displayName=n.b.displayName},9332(e,s,a){a.d(s,{cn:()=>i});var t=a(2004),l=a(9800);function i(){for(var e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,l.QP)((0,t.$)(s))}},3845(e,s,a){a.r(s),a.d(s,{default:()=>F});var t=a(2555),l=a(9950),i=a(5030),n=a(5532),r=a(5412),o=a(7465),d=a(6910),c=a(1111),m=a(4779),h=a(557),x=a(7255),u=a(9126),g=a(6311),b=a(7304),p=a(9027),f=a(7834),j=a(2989),v=a(2959),N=a(3198),y=a(1742),w=a(1420),k=a(6479),A=a(8541),S=a(4731),C=a(2607),_=a(2033),B=a(3986),z=a(3401),R=a(9332),E=a(4414);const J=["className"],I=l.forwardRef((e,s)=>{let{className:a}=e,l=(0,B.A)(e,J);return(0,E.jsxs)(z.bL,(0,t.A)((0,t.A)({ref:s,className:(0,R.cn)("relative flex w-full touch-none select-none items-center",a)},l),{},{children:[(0,E.jsx)(z.CC,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:(0,E.jsx)(z.Q6,{className:"absolute h-full bg-primary"})}),(0,E.jsx)(z.zi,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}))});I.displayName=z.bL.displayName;const L="".concat("","/api");function F(){var e;const{t:s}=(0,i.Bd)(),{user:a,schoolId:B,selectSchool:z,refreshSchoolData:R}=(0,n.As)(),{language:J,changeLanguage:F}=(0,r.ok)(),{isDarkMode:M,toggleDarkMode:P,activePreset:T,setActivePreset:D,customHeaderColor:O,setCustomHeaderColor:$,headerLogoSize:G,setHeaderLogoSize:H}=(0,o.DP)(),[U,V]=(0,l.useState)([]),[W,q]=(0,l.useState)(!0),[Y,Q]=(0,l.useState)(!1),[X,Z]=(0,l.useState)(!1),[K,ee]=(0,l.useState)(null),[se,ae]=(0,l.useState)(null),[te,le]=(0,l.useState)(!1),[ie,ne]=(0,l.useState)(!1),re=(0,l.useRef)(null),oe=(0,l.useRef)(null),[de,ce]=(0,l.useState)(null),[me,he]=(0,l.useState)(100),[xe,ue]=(0,l.useState)(100),[ge,be]=(0,l.useState)(!1),[pe,fe]=(0,l.useState)(5),[je,ve]=(0,l.useState)("large"),[Ne,ye]=(0,l.useState)(!1),we=(0,l.useRef)(null),[ke,Ae]=(0,l.useState)({name:"",address:"",board_type:"CBSE",city:"",state:"",phone:"",email:""}),Se=[{key:"dashboard",label:"Dashboard"},{key:"students",label:"Students"},{key:"staff",label:"Staff"},{key:"classes",label:"Classes"},{key:"attendance",label:"Attendance"},{key:"timetable",label:"Timetable"},{key:"exams_reports",label:"Exams & Reports"},{key:"homework",label:"Homework"},{key:"digital_library",label:"Digital Library"},{key:"live_classes",label:"Live Classes"},{key:"fee_management",label:"Fee Management"},{key:"admissions",label:"Admissions CRM"},{key:"communication_hub",label:"Communication Hub"},{key:"front_office",label:"Front Office"},{key:"transport",label:"Transport"},{key:"inventory",label:"Inventory"},{key:"cctv",label:"CCTV"},{key:"calendar",label:"Calendar"},{key:"ai_tools",label:"AI Tools"},{key:"tino_ai_chat",label:"Tino AI Chat"},{key:"analytics",label:"Analytics"},{key:"multi_branch",label:"Multi-Branch"}],Ce=["schooltino","teachtino"],_e={schooltino:"SchoolTino (Admin)",teachtino:"TeachTino (Teachers)"},Be=()=>{const e={};return Se.forEach(s=>{e[s.key]={schooltino:!0,teachtino:!0}}),e},[ze,Re]=(0,l.useState)(Be),[Ee,Je]=(0,l.useState)(!1);(0,l.useEffect)(()=>{Ie(),Le(),(async()=>{const e=Be();let s=null;try{const e=localStorage.getItem("token"),a=await d.A.get("".concat(L,"/settings/module-visibility"),{headers:{Authorization:"Bearer ".concat(e)}});a.data&&Object.keys(a.data).length>0&&(s=a.data)}catch(l){console.log("Backend module visibility not available, using local")}if(!s)try{const e=localStorage.getItem("module_visibility_settings");e&&(s=JSON.parse(e))}catch(i){}const a=(0,t.A)({},e);s&&Object.keys(s).forEach(l=>{a[l]=(0,t.A)((0,t.A)({},e[l]),s[l])}),Re(a),localStorage.setItem("module_visibility_settings",JSON.stringify(a)),window.dispatchEvent(new Event("module_visibility_changed"))})(),Fe()},[]);const Ie=async()=>{try{const e=await d.A.get("".concat(L,"/schools"));V(e.data)}catch(e){console.error("Failed to fetch schools")}finally{q(!1)}},Le=async()=>{try{const e=await d.A.get("".concat(L,"/school/signature-seal"));ee(e.data.signature_url),ae(e.data.seal_url)}catch(e){console.error("Failed to fetch signature/seal")}},Fe=async()=>{if(B)try{const e=localStorage.getItem("token"),s=await d.A.get("".concat(L,"/schools/").concat(B),{headers:{Authorization:"Bearer ".concat(e)}});s.data&&(ce(s.data.logo_url||null),he(s.data.logo_size||100),ue(s.data.logo_opacity||100),be(s.data.watermark_enabled||!1),fe(s.data.watermark_opacity||5),ve(s.data.watermark_size||"large"))}catch(e){console.log("Branding settings not loaded")}},Me=e=>{Ae(s=>(0,t.A)((0,t.A)({},s),{},{[e.target.name]:e.target.value}))};return"director"!==(null===a||void 0===a?void 0:a.role)?(0,E.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,E.jsxs)("div",{className:"text-center bg-white rounded-xl shadow-md p-8 max-w-md",children:[(0,E.jsx)("div",{className:"text-5xl mb-4",children:"\ud83d\udd12"}),(0,E.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:s("access_denied")}),(0,E.jsx)("p",{className:"text-gray-500",children:"Only the Director/Admin can access Settings. Contact your school director for permission changes."})]})}):(0,E.jsxs)("div",{className:"space-y-8","data-testid":"settings-page",children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("h1",{className:"text-3xl font-bold font-heading text-slate-900",children:s("settings")}),(0,E.jsx)("p",{className:"text-slate-500 mt-1",children:s("manage_preferences")})]}),(0,E.jsx)("div",{className:"flex flex-wrap gap-2",children:[{id:"profile-section",icon:"\ud83d\udc64",label:s("profile")},{id:"language-section",icon:"\ud83c\udf10",label:"Language / \u092d\u093e\u0937\u093e"},{id:"theme-section",icon:"\ud83c\udfa8",label:s("theme_settings")},{id:"branding-section",icon:"\ud83d\uddbc\ufe0f",label:s("logo_branding")},{id:"modules-section",icon:"\ud83d\udce6",label:s("module_management")}].map(e=>(0,E.jsxs)("button",{onClick:()=>{var s;return null===(s=document.getElementById(e.id))||void 0===s?void 0:s.scrollIntoView({behavior:"smooth",block:"start"})},className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-white border border-slate-200 hover:border-blue-400 hover:bg-blue-50 transition-all text-sm font-medium text-slate-700 shadow-sm",children:[(0,E.jsx)("span",{children:e.icon})," ",e.label]},e.id))}),(0,E.jsxs)("div",{className:"stat-card",id:"profile-section",children:[(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900 mb-4",children:s("profile")}),(0,E.jsxs)("div",{className:"flex items-center gap-4",children:[(0,E.jsx)("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:null===a||void 0===a||null===(e=a.name)||void 0===e?void 0:e.charAt(0).toUpperCase()}),(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:null===a||void 0===a?void 0:a.name}),(0,E.jsx)("p",{className:"text-slate-500",children:null===a||void 0===a?void 0:a.email}),(0,E.jsx)("span",{className:"badge badge-info capitalize mt-1",children:null===a||void 0===a?void 0:a.role})]})]})]}),(0,E.jsxs)("div",{className:"stat-card",id:"language-section",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,E.jsx)(u.A,{className:"w-5 h-5 text-indigo-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Language / \u092d\u093e\u0937\u093e"})]}),(0,E.jsxs)("div",{className:"flex gap-3 flex-wrap",children:[(0,E.jsxs)("button",{onClick:()=>F("en"),className:"px-6 py-3 rounded-xl border-2 transition-all ".concat("en"===J?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-slate-200 hover:border-slate-300"),"data-testid":"lang-en-btn",children:[(0,E.jsx)("span",{className:"font-medium",children:"English"}),"en"===J&&(0,E.jsx)(g.A,{className:"w-4 h-4 inline ml-2"})]}),(0,E.jsxs)("button",{onClick:()=>F("hi"),className:"px-6 py-3 rounded-xl border-2 transition-all ".concat("hi"===J?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-slate-200 hover:border-slate-300"),"data-testid":"lang-hi-btn",children:[(0,E.jsx)("span",{className:"font-medium",children:"\u0939\u093f\u0902\u0926\u0940"}),"hi"===J&&(0,E.jsx)(g.A,{className:"w-4 h-4 inline ml-2"})]}),(0,E.jsxs)("button",{onClick:()=>F("hinglish"),className:"px-6 py-3 rounded-xl border-2 transition-all ".concat("hinglish"===J?"border-indigo-600 bg-indigo-50 text-indigo-700":"border-slate-200 hover:border-slate-300"),"data-testid":"lang-hinglish-btn",children:[(0,E.jsx)("span",{className:"font-medium",children:"Hinglish \ud83d\udd04"}),"hinglish"===J&&(0,E.jsx)(g.A,{className:"w-4 h-4 inline ml-2"})]})]})]}),(0,E.jsxs)("div",{className:"stat-card border-2 border-purple-100",id:"theme-section",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,E.jsx)(b.A,{className:"w-5 h-5 text-purple-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s("theme_settings")})]}),(0,E.jsx)("div",{className:"mb-6",children:(0,E.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,E.jsxs)("div",{children:[(0,E.jsx)(h.J,{className:"text-sm font-medium text-slate-700",children:s("dark_mode")}),(0,E.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:M?"Dark theme is active":"Switch to dark theme"})]}),(0,E.jsx)("button",{onClick:P,className:"relative w-12 h-6 rounded-full transition-colors ".concat(M?"bg-blue-600":"bg-slate-300"),children:(0,E.jsx)("span",{className:"absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform ".concat(M?"left-[26px]":"left-0.5")})})]})}),(0,E.jsxs)("div",{className:"mb-6",children:[(0,E.jsx)(h.J,{className:"text-sm font-medium text-slate-700 mb-3 block",children:s("header_color")}),(0,E.jsx)("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-2 mb-3",children:Object.entries(o.b3).map(e=>{let[s,a]=e;return(0,E.jsx)("button",{onClick:()=>{D(s),$("")},className:"relative w-full aspect-square rounded-xl border-2 transition-all hover:scale-110 ".concat(T!==s||O?"border-transparent":"border-slate-900 ring-2 ring-offset-2 ring-blue-400"),style:{backgroundColor:a.headerBg},title:a.name,children:T===s&&!O&&(0,E.jsx)(g.A,{className:"w-4 h-4 text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})},s)})}),(0,E.jsxs)("div",{className:"flex items-center gap-3 mt-3",children:[(0,E.jsxs)(h.J,{className:"text-xs text-slate-500 whitespace-nowrap",children:[s("customize"),":"]}),(0,E.jsx)("input",{type:"color",value:O||"#3b82f6",onChange:e=>$(e.target.value),className:"w-8 h-8 rounded-lg cursor-pointer border border-slate-200"}),O&&(0,E.jsx)(c.$,{variant:"ghost",size:"sm",onClick:()=>$(""),className:"text-xs text-slate-500",children:s("reset")})]})]}),(0,E.jsxs)("div",{className:"mb-2",children:[(0,E.jsxs)(h.J,{className:"text-sm font-medium text-slate-700 mb-2 block",children:[s("logo_size")," (",s("header_color").split(" ")[0],")"]}),(0,E.jsxs)("div",{className:"flex items-center gap-4",children:[(0,E.jsx)("span",{className:"text-xs text-slate-500",children:s("small")}),(0,E.jsx)(I,{value:[G],onValueChange:e=>H(e[0]),min:24,max:56,step:2,className:"flex-1"}),(0,E.jsx)("span",{className:"text-xs text-slate-500",children:s("large")}),(0,E.jsxs)("span",{className:"text-xs text-slate-400 w-8 text-right",children:[G,"px"]})]})]})]}),("director"===(null===a||void 0===a?void 0:a.role)||"principal"===(null===a||void 0===a?void 0:a.role))&&(0,E.jsxs)("div",{className:"stat-card",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,E.jsx)(p.A,{className:"w-5 h-5 text-indigo-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s("signature_seal")})]}),(0,E.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:"Ye signature aur seal notices pe automatically show honge"}),(0,E.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,E.jsxs)("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-4 hover:border-indigo-300 transition-all",children:[(0,E.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,E.jsx)(p.A,{className:"w-4 h-4 text-indigo-600"}),(0,E.jsx)("span",{className:"font-medium text-slate-700",children:"Signature"})]}),K?(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsx)("img",{src:"".concat("").concat(K),alt:"Signature",className:"w-full h-24 object-contain bg-white rounded-lg border"}),(0,E.jsx)("button",{onClick:()=>{var e;return null===(e=re.current)||void 0===e?void 0:e.click()},className:"absolute top-2 right-2 p-1 bg-white rounded-full shadow hover:bg-slate-100",children:(0,E.jsx)(f.A,{className:"w-4 h-4 text-slate-600"})})]}):(0,E.jsx)("button",{onClick:()=>{var e;return null===(e=re.current)||void 0===e?void 0:e.click()},disabled:te,className:"w-full h-24 flex flex-col items-center justify-center bg-slate-50 rounded-lg border border-slate-200 hover:bg-slate-100 transition-all",children:te?(0,E.jsx)(j.A,{className:"w-6 h-6 animate-spin text-indigo-600"}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(f.A,{className:"w-6 h-6 text-slate-400 mb-1"}),(0,E.jsx)("span",{className:"text-sm text-slate-500",children:s("upload_signature")})]})}),(0,E.jsx)("input",{ref:re,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files[0];if(s)if(s.size>2097152)_.oR.error("File size should be less than 2MB");else{le(!0);try{const e=new FormData;e.append("file",s);const a=await d.A.post("".concat(L,"/school/upload-signature"),e,{headers:{"Content-Type":"multipart/form-data"}});ee(a.data.url),_.oR.success("Signature uploaded successfully! \u270d\ufe0f")}catch(a){_.oR.error("Failed to upload signature")}finally{le(!1)}}},className:"hidden"}),(0,E.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"PNG/JPG, max 2MB"})]}),(0,E.jsxs)("div",{className:"border-2 border-dashed border-slate-200 rounded-xl p-4 hover:border-indigo-300 transition-all",children:[(0,E.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,E.jsx)(v.A,{className:"w-4 h-4 text-indigo-600"}),(0,E.jsx)("span",{className:"font-medium text-slate-700",children:"School Seal/Stamp"})]}),se?(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsx)("img",{src:"".concat("").concat(se),alt:"Seal",className:"w-full h-24 object-contain bg-white rounded-lg border"}),(0,E.jsx)("button",{onClick:()=>{var e;return null===(e=oe.current)||void 0===e?void 0:e.click()},className:"absolute top-2 right-2 p-1 bg-white rounded-full shadow hover:bg-slate-100",children:(0,E.jsx)(f.A,{className:"w-4 h-4 text-slate-600"})})]}):(0,E.jsx)("button",{onClick:()=>{var e;return null===(e=oe.current)||void 0===e?void 0:e.click()},disabled:ie,className:"w-full h-24 flex flex-col items-center justify-center bg-slate-50 rounded-lg border border-slate-200 hover:bg-slate-100 transition-all",children:ie?(0,E.jsx)(j.A,{className:"w-6 h-6 animate-spin text-indigo-600"}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(v.A,{className:"w-6 h-6 text-slate-400 mb-1"}),(0,E.jsx)("span",{className:"text-sm text-slate-500",children:s("upload_seal")})]})}),(0,E.jsx)("input",{ref:oe,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files[0];if(s)if(s.size>2097152)_.oR.error("File size should be less than 2MB");else{ne(!0);try{const e=new FormData;e.append("file",s);const a=await d.A.post("".concat(L,"/school/upload-seal"),e,{headers:{"Content-Type":"multipart/form-data"}});ae(a.data.url),_.oR.success("Seal uploaded successfully! \ud83d\udd16")}catch(a){_.oR.error("Failed to upload seal")}finally{ne(!1)}}},className:"hidden"}),(0,E.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"PNG/JPG, max 2MB"})]})]})]}),("director"===(null===a||void 0===a?void 0:a.role)||"principal"===(null===a||void 0===a?void 0:a.role))&&(0,E.jsxs)("div",{className:"stat-card border-2 border-blue-100",id:"branding-section",children:[(0,E.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3",children:[(0,E.jsx)(N.A,{className:"w-5 h-5 text-blue-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s("logo_branding")})]}),(0,E.jsxs)(c.$,{onClick:async()=>{if(B){ye(!0);try{const e=localStorage.getItem("token");await d.A.post("".concat(L,"/schools/").concat(B,"/branding"),{logo_url:de,logo_size:me,logo_opacity:xe,watermark_enabled:ge,watermark_opacity:pe,watermark_size:je},{headers:{Authorization:"Bearer ".concat(e)}}),_.oR.success("Branding settings saved! Changes will reflect across all portals."),R&&R()}catch(e){_.oR.error("Failed to save branding settings")}finally{ye(!1)}}else _.oR.error("No school selected")},disabled:Ne,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[Ne?(0,E.jsx)(j.A,{className:"w-4 h-4 animate-spin mr-2"}):(0,E.jsx)(y.A,{className:"w-4 h-4 mr-2"}),s("save")]})]}),(0,E.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:"School Logo"}),(0,E.jsxs)("div",{className:"flex items-center gap-4",children:[(0,E.jsx)("div",{className:"w-24 h-24 border-2 border-dashed border-blue-300 rounded-xl flex items-center justify-center overflow-hidden bg-slate-50",children:de?(0,E.jsx)("img",{src:de,alt:"Logo",className:"w-full h-full object-contain p-1"}):(0,E.jsx)(w.A,{className:"w-8 h-8 text-slate-300"})}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)("input",{ref:we,type:"file",accept:"image/*",onChange:async e=>{const s=e.target.files[0];if(s)if(s.size>5242880)_.oR.error("File size should be less than 5MB");else try{const e=new FileReader;e.onload=e=>ce(e.target.result),e.readAsDataURL(s),_.oR.success("Logo updated! Save to apply.")}catch(e){_.oR.error("Failed to process logo")}},className:"hidden"}),(0,E.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=we.current)||void 0===e?void 0:e.click()},children:[(0,E.jsx)(f.A,{className:"w-4 h-4 mr-2"})," ",de?"Change Logo":"Upload Logo"]}),de&&(0,E.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>ce(null),className:"text-red-500 hover:text-red-700",children:[(0,E.jsx)(k.A,{className:"w-4 h-4 mr-2"})," Remove"]})]})]})]}),(0,E.jsxs)("div",{className:"space-y-4",children:[(0,E.jsx)("h3",{className:"text-sm font-semibold text-slate-700 mb-2",children:"Logo Size & Transparency"}),(0,E.jsxs)("div",{children:[(0,E.jsxs)(h.J,{className:"text-sm text-slate-600",children:["Size: ",me,"%"]}),(0,E.jsx)("input",{type:"range",min:"30",max:"200",value:me,onChange:e=>he(parseInt(e.target.value)),className:"w-full mt-1 accent-blue-600"}),(0,E.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,E.jsx)("span",{children:"30%"}),(0,E.jsx)("span",{children:"200%"})]})]}),(0,E.jsxs)("div",{children:[(0,E.jsxs)(h.J,{className:"text-sm text-slate-600",children:["Transparency: ",xe,"%"]}),(0,E.jsx)("input",{type:"range",min:"10",max:"100",value:xe,onChange:e=>ue(parseInt(e.target.value)),className:"w-full mt-1 accent-blue-600"}),(0,E.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,E.jsx)("span",{children:"10%"}),(0,E.jsx)("span",{children:"100%"})]})]}),de&&(0,E.jsx)("div",{className:"flex items-center justify-center p-3 bg-slate-50 rounded-lg border",children:(0,E.jsx)("img",{src:de,alt:"Preview",style:{transform:"scale(".concat(me/100,")"),opacity:xe/100,maxWidth:"150px",maxHeight:"100px"},className:"object-contain transition-transform"})})]})]}),(0,E.jsxs)("div",{className:"border-t border-slate-200 mt-6 pt-4",children:[(0,E.jsx)("h3",{className:"text-sm font-semibold text-slate-700 mb-3",children:s("watermark_settings")}),(0,E.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer p-3 rounded-lg bg-blue-50 border border-blue-200 hover:bg-blue-100 mb-4",children:[(0,E.jsx)("input",{type:"checkbox",checked:ge,onChange:e=>be(e.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-600 accent-blue-600"}),(0,E.jsxs)("div",{children:[(0,E.jsx)("span",{className:"font-medium text-sm",children:"Enable Logo Watermark (\u0935\u0949\u091f\u0930\u092e\u093e\u0930\u094d\u0915 \u091a\u093e\u0932\u0942 \u0915\u0930\u0947\u0902)"}),(0,E.jsx)("p",{className:"text-xs text-slate-500",children:"All portals (SchoolTino, TeachTino, StudyTino) mein watermark dikhega"})]})]}),ge&&(0,E.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,E.jsxs)("div",{children:[(0,E.jsxs)(h.J,{className:"text-sm text-slate-600",children:["Watermark Opacity: ",pe,"%"]}),(0,E.jsx)("input",{type:"range",min:"2",max:"20",value:pe,onChange:e=>fe(parseInt(e.target.value)),className:"w-full mt-1 accent-blue-600"}),(0,E.jsxs)("div",{className:"flex justify-between text-xs text-slate-400",children:[(0,E.jsx)("span",{children:"Light (2%)"}),(0,E.jsx)("span",{children:"Dark (20%)"})]})]}),(0,E.jsxs)("div",{children:[(0,E.jsx)(h.J,{className:"text-sm text-slate-600",children:"Watermark Size"}),(0,E.jsxs)("select",{value:je,onChange:e=>ve(e.target.value),className:"w-full h-10 rounded-md border border-slate-200 px-3 text-sm mt-1",children:[(0,E.jsx)("option",{value:"small",children:"Small (\u091b\u094b\u091f\u093e)"}),(0,E.jsx)("option",{value:"medium",children:"Medium (\u092e\u0927\u094d\u092f\u092e)"}),(0,E.jsx)("option",{value:"large",children:"Large (\u092c\u0921\u093c\u093e)"}),(0,E.jsx)("option",{value:"full",children:"Full Page (\u092a\u0942\u0930\u093e \u092a\u0947\u091c)"})]})]})]}),ge&&de&&(0,E.jsxs)("div",{className:"mt-4 relative h-40 bg-white rounded-lg border overflow-hidden flex items-center justify-center",children:[(0,E.jsx)("img",{src:de,alt:"Watermark Preview",style:{opacity:pe/100,width:"small"===je?"80px":"medium"===je?"150px":"full"===je?"80%":"250px"},className:"object-contain"}),(0,E.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,E.jsx)("span",{className:"text-slate-300 text-lg font-bold",children:"Watermark Preview"})})]})]})]}),("director"===(null===a||void 0===a?void 0:a.role)||"principal"===(null===a||void 0===a?void 0:a.role))&&(0,E.jsxs)("div",{className:"stat-card border-2 border-violet-100",id:"modules-section","data-testid":"module-management-section",children:[(0,E.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3",children:[(0,E.jsx)(A.A,{className:"w-5 h-5 text-violet-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s("module_management")})]}),(0,E.jsxs)(c.$,{onClick:async()=>{Je(!0);try{localStorage.setItem("module_visibility_settings",JSON.stringify(ze));const e=localStorage.getItem("token");await d.A.post("".concat(L,"/settings/module-visibility"),ze,{headers:{Authorization:"Bearer ".concat(e)}}),_.oR.success("Module settings saved! Sidebar updated.")}catch(e){localStorage.setItem("module_visibility_settings",JSON.stringify(ze)),_.oR.success("Settings saved locally! Sidebar updated.")}finally{Je(!1)}},disabled:Ee,className:"bg-violet-600 hover:bg-violet-700 text-white","data-testid":"save-module-visibility-btn",children:[Ee?(0,E.jsx)(j.A,{className:"w-4 h-4 animate-spin mr-2"}):(0,E.jsx)(g.A,{className:"w-4 h-4 mr-2"}),s("save")]})]}),(0,E.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:"Enable or disable modules for each portal. Changes will apply immediately after saving."}),(0,E.jsx)("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden",children:(0,E.jsx)("div",{className:"overflow-x-auto",children:(0,E.jsxs)("table",{className:"w-full text-sm",children:[(0,E.jsx)("thead",{children:(0,E.jsxs)("tr",{className:"bg-slate-50 border-b border-slate-200",children:[(0,E.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-slate-700",children:"Module"}),Ce.map(e=>(0,E.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-slate-700",children:_e[e]},e))]})}),(0,E.jsx)("tbody",{children:Se.map((e,a)=>(0,E.jsxs)("tr",{className:a%2===0?"bg-white":"bg-slate-50",children:[(0,E.jsx)("td",{className:"py-2.5 px-4 font-medium text-slate-800",children:s(e.key)}),Ce.map(s=>{var a,l;return(0,E.jsx)("td",{className:"text-center py-2.5 px-4",children:(0,E.jsx)("button",{onClick:()=>((e,s)=>{var a;const l=(0,t.A)((0,t.A)({},ze),{},{[e]:(0,t.A)((0,t.A)({},ze[e]),{},{[s]:!(null!==(a=ze[e])&&void 0!==a&&a[s])})});Re(l),localStorage.setItem("module_visibility_settings",JSON.stringify(l)),window.dispatchEvent(new Event("module_visibility_changed"))})(e.key,s),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(null!==(a=ze[e.key])&&void 0!==a&&a[s]?"bg-violet-600":"bg-slate-300"),"data-testid":"toggle-".concat(e.key,"-").concat(s),children:(0,E.jsx)("span",{className:"inline-block h-4 w-4 rounded-full bg-white transition-transform ".concat(null!==(l=ze[e.key])&&void 0!==l&&l[s]?"translate-x-6":"translate-x-1")})})},s)})]},e.key))})]})})})]}),(0,E.jsxs)("div",{className:"stat-card",children:[(0,E.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,E.jsxs)("div",{className:"flex items-center gap-3",children:[(0,E.jsx)(S.A,{className:"w-5 h-5 text-indigo-600"}),(0,E.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Schools"})]}),"director"===(null===a||void 0===a?void 0:a.role)&&(0,E.jsxs)(x.lG,{open:Y,onOpenChange:Q,children:[(0,E.jsx)(x.zM,{asChild:!0,children:(0,E.jsxs)(c.$,{className:"btn-primary","data-testid":"add-school-btn",children:[(0,E.jsx)(C.A,{className:"w-5 h-5 mr-2"}),"Add School"]})}),(0,E.jsxs)(x.Cf,{className:"max-w-lg",children:[(0,E.jsxs)(x.c7,{children:[(0,E.jsx)(x.L3,{children:"Add New School"}),(0,E.jsx)(x.rr,{className:"sr-only",children:"Fill the form to add a new school"})]}),(0,E.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),Z(!0);try{const e=await d.A.post("".concat(L,"/schools"),ke);_.oR.success("School created successfully"),Q(!1),Ae({name:"",address:"",board_type:"CBSE",city:"",state:"",phone:"",email:""}),Ie(),z(e.data.id)}catch(l){var a,t;const e=null===(a=l.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.detail;_.oR.error("string"===typeof e?e:s("something_went_wrong"))}finally{Z(!1)}},className:"space-y-4 mt-4",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"School Name *"}),(0,E.jsx)(m.p,{name:"name",value:ke.name,onChange:Me,required:!0,"data-testid":"school-name-input"})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"Address *"}),(0,E.jsx)(m.p,{name:"address",value:ke.address,onChange:Me,required:!0,"data-testid":"school-address-input"})]}),(0,E.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"City *"}),(0,E.jsx)(m.p,{name:"city",value:ke.city,onChange:Me,required:!0,"data-testid":"school-city-input"})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"State *"}),(0,E.jsx)(m.p,{name:"state",value:ke.state,onChange:Me,required:!0,"data-testid":"school-state-input"})]})]}),(0,E.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"Board Type *"}),(0,E.jsxs)("select",{name:"board_type",value:ke.board_type,onChange:Me,className:"w-full h-10 rounded-lg border border-slate-200 px-3","data-testid":"school-board-select",children:[(0,E.jsx)("option",{value:"MPBSE",children:"MP Board (MPBSE)"}),(0,E.jsx)("option",{value:"RBSE",children:"Rajasthan Board (RBSE)"}),(0,E.jsx)("option",{value:"CBSE",children:"CBSE"}),(0,E.jsx)("option",{value:"ICSE",children:"ICSE"}),(0,E.jsx)("option",{value:"UP Board",children:"UP Board"}),(0,E.jsx)("option",{value:"Bihar Board",children:"Bihar Board"}),(0,E.jsx)("option",{value:"CG Board",children:"CG Board (CGBSE)"}),(0,E.jsx)("option",{value:"State Board",children:"Other State Board"}),(0,E.jsx)("option",{value:"IB",children:"IB"})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"Phone"}),(0,E.jsx)(m.p,{name:"phone",value:ke.phone,onChange:Me,"data-testid":"school-phone-input"})]})]}),(0,E.jsxs)("div",{className:"space-y-2",children:[(0,E.jsx)(h.J,{children:"Email"}),(0,E.jsx)(m.p,{name:"email",type:"email",value:ke.email,onChange:Me,"data-testid":"school-email-input"})]}),(0,E.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,E.jsx)(c.$,{type:"button",variant:"outline",onClick:()=>Q(!1),children:s("cancel")}),(0,E.jsxs)(c.$,{type:"submit",className:"btn-primary",disabled:X,"data-testid":"save-school-btn",children:[X?(0,E.jsx)(j.A,{className:"w-4 h-4 animate-spin mr-2"}):null,s("save")]})]})]})]})]})]}),W?(0,E.jsx)("div",{className:"flex justify-center py-10",children:(0,E.jsx)("div",{className:"spinner w-8 h-8"})}):0===U.length?(0,E.jsxs)("div",{className:"text-center py-10",children:[(0,E.jsx)(S.A,{className:"w-12 h-12 text-slate-300 mx-auto mb-2"}),(0,E.jsx)("p",{className:"text-slate-500",children:"No schools added yet"}),(0,E.jsx)("p",{className:"text-sm text-slate-400",children:"Add a school to get started"})]}):(0,E.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:U.map(e=>(0,E.jsx)("div",{className:"p-4 rounded-xl border-2 cursor-pointer transition-all ".concat(B===e.id?"border-indigo-600 bg-indigo-50":"border-slate-200 hover:border-slate-300"),onClick:()=>{return s=e.id,z(s),void _.oR.success("School selected");var s},"data-testid":"school-card-".concat(e.id),children:(0,E.jsxs)("div",{className:"flex items-start justify-between",children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("h3",{className:"font-semibold text-slate-900",children:e.name}),(0,E.jsxs)("p",{className:"text-sm text-slate-500",children:[e.city,", ",e.state]}),(0,E.jsx)("span",{className:"badge badge-info mt-2",children:e.board_type})]}),B===e.id&&(0,E.jsx)("div",{className:"w-6 h-6 bg-indigo-600 rounded-full flex items-center justify-center",children:(0,E.jsx)(g.A,{className:"w-4 h-4 text-white"})})]})},e.id))})]})]})}}}]);