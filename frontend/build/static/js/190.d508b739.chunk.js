/*! For license information please see 190.d508b739.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[190],{190(e,t,a){a.r(t),a.d(t,{default:()=>C});var s=a(2555),r=a(5043),n=a(6930),c=a(8729),l=a(9722),o=a(7819),i=a(4918),d=a(614),u=a(247),x=a(67),m=a(2024),h=a(5746),p=a(2638),y=a(5088),g=a(7784);const v=(0,g.A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);var f=a(8306),b=a(9855),j=a(2574);const w=(0,g.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var N=a(2382),k=a(579);const A="".concat("","/api"),_=[{id:"demo-1",author_name:"Principal",author_avatar:"P",author_role:"principal",author_id:"demo",created_at:new Date(Date.now()-72e5).toISOString(),content:"Annual sports day preparations are in full swing! Students are showing great enthusiasm for various events.",likes:[],likes_count:24,comments:[],comments_count:8,type:"announcement",photo_url:null},{id:"demo-2",author_name:"Class 10 Teacher",author_avatar:"T",author_role:"teacher",author_id:"demo",created_at:new Date(Date.now()-18e6).toISOString(),content:"Science lab session was wonderful today. Students performed experiments on chemical reactions with great curiosity.",likes:[],likes_count:15,comments:[],comments_count:3,type:"activity",photo_url:null},{id:"demo-3",author_name:"Admin Office",author_avatar:"A",author_role:"admin",author_id:"demo",created_at:new Date(Date.now()-864e5).toISOString(),content:"Fee submission deadline for Q3 has been extended to 25th March. Parents are requested to submit fees before the deadline.",likes:[],likes_count:42,comments:[],comments_count:12,type:"notice",photo_url:null}];function S(e){if(!e)return"";const t=new Date,a=new Date(e),s=Math.floor((t-a)/1e3);if(s<60)return"Just now";const r=Math.floor(s/60);if(r<60)return"".concat(r,"m ago");const n=Math.floor(r/60);if(n<24)return"".concat(n,"h ago");const c=Math.floor(n/24);return c<7?"".concat(c,"d ago"):a.toLocaleDateString()}function C(){const{t:e}=(0,n.Bd)(),{user:t,schoolData:a}=(0,c.As)(),g=(null===t||void 0===t?void 0:t.school_id)||(null===a||void 0===a?void 0:a.id)||"",C=(null===t||void 0===t?void 0:t.id)||"",D=(null===t||void 0===t?void 0:t.name)||"User",M=(null===t||void 0===t?void 0:t.role)||"teacher",[P,U]=(0,r.useState)([]),[q,z]=(0,r.useState)(!0),[L,O]=(0,r.useState)(""),[I,T]=(0,r.useState)("activity"),[W,E]=(0,r.useState)(!1),[F,R]=(0,r.useState)(null),[V,B]=(0,r.useState)(null),[H,Z]=(0,r.useState)(!1),[G,J]=(0,r.useState)({}),[K,Q]=(0,r.useState)({}),[X,Y]=(0,r.useState)(null),[$,ee]=(0,r.useState)(null),te=(0,r.useRef)(null),ae=(0,r.useCallback)(function(e){Y({msg:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>Y(null),3e3)},[]),se=["director","principal","vice_principal","admin","super_admin"].includes(M),re=(0,r.useCallback)(async()=>{if(!g)return U(_),void z(!1);try{var e;const t=(null===(e=(await l.A.get("".concat(A,"/school-feed/").concat(g))).data)||void 0===e?void 0:e.posts)||[];U(t.length>0?t:_)}catch(t){U(_)}finally{z(!1)}},[g]);(0,r.useEffect)(()=>{re()},[re]);const ne=()=>{R(null),B(null),te.current&&(te.current.value="")},ce=async e=>{const t=(K[e]||"").trim();if(!t)return;const a={id:"cmt-".concat(Date.now()),user_id:C,user_name:D,text:t,created_at:(new Date).toISOString()};U(t=>t.map(t=>t.id!==e?t:(0,s.A)((0,s.A)({},t),{},{comments:[...t.comments||[],a],comments_count:(t.comments_count||0)+1}))),Q(t=>(0,s.A)((0,s.A)({},t),{},{[e]:""}));try{await l.A.post("".concat(A,"/school-feed/").concat(e,"/comment"),{user_id:C,user_name:D,text:t})}catch(r){}},le=e=>{const t="".concat(window.location.origin,"/school-feed?post=").concat(e);navigator.clipboard.writeText(t).then(()=>{ae("Link copied to clipboard!")}).catch(()=>{ae("Could not copy link","error")})},oe={announcement:"gradient-card-purple",activity:"gradient-card-teal",notice:"gradient-card-blue"},ie={announcement:"Announcement",activity:"Activity",notice:"Notice"};return(0,k.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6 animate-fade-in",children:[X&&(0,k.jsxs)("div",{className:"fixed top-4 right-4 z-50 px-4 py-3 rounded-xl shadow-lg text-sm font-medium flex items-center gap-2 ".concat("error"===X.type?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"),children:["error"===X.type?(0,k.jsx)(o.A,{className:"w-4 h-4"}):(0,k.jsx)(i.A,{className:"w-4 h-4"}),X.msg]}),(0,k.jsx)("div",{className:"flex items-center justify-between",children:(0,k.jsxs)("div",{children:[(0,k.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:e("school_feed")}),(0,k.jsx)("p",{className:"text-sm text-gray-500 mt-0.5",children:"Share updates, activities & announcements"})]})}),(0,k.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5",children:(0,k.jsxs)("div",{className:"flex gap-3",children:[(0,k.jsx)("div",{className:"w-10 h-10 gradient-card-blue rounded-xl flex items-center justify-center flex-shrink-0",children:(0,k.jsx)("span",{className:"text-white font-semibold text-sm",children:(null===D||void 0===D?void 0:D.charAt(0))||"U"})}),(0,k.jsxs)("div",{className:"flex-1",children:[(0,k.jsx)("textarea",{value:L,onChange:e=>O(e.target.value),placeholder:"Share an update with your school community...",className:"w-full px-0 py-1 text-sm text-gray-700 placeholder-gray-400 resize-none border-none focus:outline-none focus:ring-0 min-h-[60px]",rows:2}),V&&(0,k.jsxs)("div",{className:"relative mt-2 inline-block",children:[(0,k.jsx)("img",{src:V,alt:"Preview",className:"max-h-48 rounded-xl object-cover border border-gray-100"}),(0,k.jsx)("button",{onClick:ne,className:"absolute top-1 right-1 bg-black/60 text-white rounded-full p-1 hover:bg-black/80",children:(0,k.jsx)(d.A,{className:"w-3.5 h-3.5"})})]}),(0,k.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100 mt-2",children:[(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("input",{ref:te,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/"))return void ae("Please select an image file","error");R(a);const s=new FileReader;s.onload=e=>B(e.target.result),s.readAsDataURL(a)}}),(0,k.jsxs)("button",{onClick:()=>{var e;return null===(e=te.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,k.jsx)(u.A,{className:"w-4 h-4"})," Photo"]}),(0,k.jsxs)("button",{onClick:()=>{var e;return null===(e=te.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-gray-500 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,k.jsx)(x.A,{className:"w-4 h-4"})," Gallery"]}),(0,k.jsxs)("select",{value:I,onChange:e=>T(e.target.value),className:"text-xs text-gray-500 border border-gray-200 rounded-lg px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-blue-300",children:[(0,k.jsx)("option",{value:"activity",children:"Activity"}),(0,k.jsx)("option",{value:"announcement",children:"Announcement"}),(0,k.jsx)("option",{value:"notice",children:"Notice"})]})]}),(0,k.jsxs)("button",{onClick:async()=>{if(L.trim()||F){E(!0);try{var e;let t=null;F&&(t=await(async()=>{if(!F)return null;Z(!0);try{var e;const t=new FormData;return t.append("file",F),t.append("school_id",g),(null===(e=(await l.A.post("".concat(A,"/school-feed/upload"),t,{headers:{"Content-Type":"multipart/form-data"}})).data)||void 0===e?void 0:e.photo_url)||null}catch(t){return ae("Photo upload failed","error"),null}finally{Z(!1)}})());const a=await l.A.post("".concat(A,"/school-feed"),{school_id:g,content:L.trim(),type:I,photo_url:t});null!==(e=a.data)&&void 0!==e&&e.post&&U(e=>[a.data.post,...e.filter(e=>!e.id.startsWith("demo-"))]),O(""),ne(),T("activity"),ae("Post shared successfully!")}catch(a){var t;const e={id:"local-".concat(Date.now()),author_name:D,author_avatar:(null===(t=D[0])||void 0===t?void 0:t.toUpperCase())||"U",author_role:M,author_id:C,created_at:(new Date).toISOString(),content:L.trim(),type:I,photo_url:V,likes:[],likes_count:0,comments:[],comments_count:0};U(t=>[e,...t]),O(""),ne(),T("activity"),ae("Posted locally (server unavailable)","error")}finally{E(!1)}}},disabled:!L.trim()&&!F||W,className:"btn-primary flex items-center gap-2 px-5 py-2 text-xs disabled:opacity-50",children:[W||H?(0,k.jsx)(m.A,{className:"w-3.5 h-3.5 animate-spin"}):(0,k.jsx)(h.A,{className:"w-3.5 h-3.5"}),"Post"]})]})]})]})}),q?(0,k.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,k.jsx)(m.A,{className:"w-8 h-8 animate-spin text-blue-500"})}):(0,k.jsx)("div",{className:"space-y-4",children:0===P.length?(0,k.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center",children:[(0,k.jsx)(p.A,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,k.jsx)("p",{className:"text-gray-500 text-sm",children:"No posts yet. Be the first to share something!"})]}):P.map(e=>{var t;const a=(e.likes||[]).includes(C),r=G[e.id],n=se||e.author_id===C;return(0,k.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-5 hover:shadow-md transition-all",children:[(0,k.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,k.jsxs)("div",{className:"flex items-center gap-3",children:[(0,k.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center ".concat(oe[e.type]||"gradient-card-blue"),children:(0,k.jsx)("span",{className:"text-white font-semibold text-sm",children:e.author_avatar||(null===(t=e.author_name)||void 0===t?void 0:t[0])||"?"})}),(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.author_name}),(0,k.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium ".concat("announcement"===e.type?"bg-purple-100 text-purple-700":"notice"===e.type?"bg-blue-100 text-blue-700":"bg-teal-100 text-teal-700"),children:ie[e.type]||e.type})]}),(0,k.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-gray-400",children:[(0,k.jsx)(y.A,{className:"w-3 h-3"})," ",S(e.created_at),e.author_role&&(0,k.jsxs)("span",{className:"text-gray-300",children:["\u2022 ",e.author_role]})]})]})]}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)("button",{onClick:()=>ee($===e.id?null:e.id),className:"p-1.5 hover:bg-gray-50 rounded-lg",children:(0,k.jsx)(v,{className:"w-4 h-4 text-gray-400"})}),$===e.id&&(0,k.jsxs)("div",{className:"absolute right-0 top-8 bg-white border border-gray-200 rounded-xl shadow-lg py-1 z-10 min-w-[140px]",children:[(0,k.jsxs)("button",{onClick:()=>le(e.id),className:"w-full text-left px-4 py-2 text-xs text-gray-600 hover:bg-gray-50 flex items-center gap-2",children:[(0,k.jsx)(f.A,{className:"w-3.5 h-3.5"})," Copy Link"]}),n&&(0,k.jsxs)("button",{onClick:()=>(async e=>{ee(null);try{await l.A.delete("".concat(A,"/school-feed/").concat(e)),U(t=>t.filter(t=>t.id!==e)),ae("Post deleted")}catch(t){U(t=>t.filter(t=>t.id!==e)),ae("Post removed")}})(e.id),className:"w-full text-left px-4 py-2 text-xs text-red-600 hover:bg-red-50 flex items-center gap-2",children:[(0,k.jsx)(b.A,{className:"w-3.5 h-3.5"})," Delete"]})]})]})]}),(0,k.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed mb-3",children:e.content}),e.photo_url&&(0,k.jsx)("div",{className:"mb-3",children:(0,k.jsx)("img",{src:e.photo_url.startsWith("http")||e.photo_url.startsWith("data:")?e.photo_url:"".concat("").concat(e.photo_url),alt:"Post",className:"w-full max-h-96 object-cover rounded-xl border border-gray-100",onError:e=>{e.target.style.display="none"}})}),(0,k.jsxs)("div",{className:"flex items-center gap-6 pt-3 border-t border-gray-50",children:[(0,k.jsxs)("button",{onClick:()=>(async e=>{U(t=>t.map(t=>{if(t.id!==e)return t;const a=(t.likes||[]).includes(C),r=a?(t.likes||[]).filter(e=>e!==C):[...t.likes||[],C];return(0,s.A)((0,s.A)({},t),{},{likes:r,likes_count:r.length>0?r.length:Math.max((t.likes_count||0)+(a?-1:1),0)})}));try{await l.A.post("".concat(A,"/school-feed/").concat(e,"/like"),{user_id:C})}catch(t){}})(e.id),className:"flex items-center gap-1.5 text-xs transition-colors ".concat(a?"text-red-500":"text-gray-500 hover:text-red-500"),children:[(0,k.jsx)(i.A,{className:"w-4 h-4 ".concat(a?"fill-red-500":"")}),e.likes_count||0]}),(0,k.jsxs)("button",{onClick:()=>{return t=e.id,void J(e=>(0,s.A)((0,s.A)({},e),{},{[t]:!e[t]}));var t},className:"flex items-center gap-1.5 text-xs text-gray-500 hover:text-blue-500 transition-colors",children:[(0,k.jsx)(j.A,{className:"w-4 h-4"}),e.comments_count||0,r?(0,k.jsx)(w,{className:"w-3 h-3"}):(0,k.jsx)(N.A,{className:"w-3 h-3"})]}),(0,k.jsxs)("button",{onClick:()=>le(e.id),className:"flex items-center gap-1.5 text-xs text-gray-500 hover:text-green-500 transition-colors",children:[(0,k.jsx)(f.A,{className:"w-4 h-4"})," Share"]})]}),r&&(0,k.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-50 space-y-3",children:[(e.comments||[]).length>0&&(0,k.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:(e.comments||[]).map((e,t)=>(0,k.jsxs)("div",{className:"flex gap-2",children:[(0,k.jsx)("div",{className:"w-7 h-7 rounded-lg bg-gray-100 flex items-center justify-center flex-shrink-0",children:(0,k.jsx)("span",{className:"text-[10px] font-semibold text-gray-500",children:(e.user_name||"U")[0].toUpperCase()})}),(0,k.jsxs)("div",{className:"bg-gray-50 rounded-xl px-3 py-2 flex-1",children:[(0,k.jsx)("p",{className:"text-xs font-semibold text-gray-700",children:e.user_name||"User"}),(0,k.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:e.text}),(0,k.jsx)("p",{className:"text-[10px] text-gray-400 mt-1",children:S(e.created_at)})]})]},e.id||t))}),(0,k.jsxs)("div",{className:"flex gap-2",children:[(0,k.jsx)("input",{type:"text",value:K[e.id]||"",onChange:t=>Q(a=>(0,s.A)((0,s.A)({},a),{},{[e.id]:t.target.value})),onKeyDown:t=>"Enter"===t.key&&ce(e.id),placeholder:"Write a comment...",className:"flex-1 text-xs border border-gray-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-300 focus:border-blue-300"}),(0,k.jsx)("button",{onClick:()=>ce(e.id),disabled:!(K[e.id]||"").trim(),className:"px-3 py-2 bg-blue-500 text-white rounded-xl text-xs hover:bg-blue-600 disabled:opacity-50 transition-colors",children:(0,k.jsx)(h.A,{className:"w-3.5 h-3.5"})})]})]})]},e.id)})})]})}},247(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},2382(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},7819(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4918(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},67(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},2024(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2574(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},2638(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("rss",[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]])},8306(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},9855(e,t,a){a.d(t,{A:()=>s});const s=(0,a(7784).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}}]);
//# sourceMappingURL=190.d508b739.chunk.js.map